[
  {
    "id": 0,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 1,
    "end_line": 30,
    "snippet": "/**\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n *\n * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n * graphic logo is a trademark of OpenMRS Inc.\n */\npackage org.openmrs.api;\n\nimport java.util.Collection;\nimport java.util.Date;\nimport java.util.List;\n\nimport org.openmrs.Allergies;\nimport org.openmrs.Allergy;\nimport org.openmrs.Concept;\nimport org.openmrs.Location;\nimport org.openmrs.Patient;\nimport org.openmrs.PatientIdentifier;\nimport org.openmrs.PatientIdentifierType;\nimport org.openmrs.PatientProgram;\nimport org.openmrs.annotation.Authorized;\nimport org.openmrs.api.db.PatientDAO;\nimport org.openmrs.comparator.PatientIdentifierTypeDefaultComparator;\nimport org.openmrs.patient.IdentifierValidator;\nimport org.openmrs.person.PersonMergeLogData;\nimport org.openmrs.serialization.SerializationException;\nimport org.openmrs.util.PrivilegeConstants;",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 1,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 23,
    "end_line": 52,
    "snippet": "import org.openmrs.PatientProgram;\nimport org.openmrs.annotation.Authorized;\nimport org.openmrs.api.db.PatientDAO;\nimport org.openmrs.comparator.PatientIdentifierTypeDefaultComparator;\nimport org.openmrs.patient.IdentifierValidator;\nimport org.openmrs.person.PersonMergeLogData;\nimport org.openmrs.serialization.SerializationException;\nimport org.openmrs.util.PrivilegeConstants;\n\n/**\n * Contains methods pertaining to Patients in the system\n * \n * <pre>\n * Usage:\n * List&lt;Patient&gt; patients = Context.getPatientService().getAllPatients();\n * </pre>\n * \n * @see org.openmrs.api.context.Context\n * @see org.openmrs.Patient\n */\npublic interface PatientService extends OpenmrsService {\n\t\n\t/**\n\t * Sets the DAO for this service. This is done by DI and Spring. See the\n\t * applicationContext-service.xml definition file.\n\t * \n\t * @param dao DAO for this service\n\t */\n\tpublic void setPatientDAO(PatientDAO dao);\n\t\t",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 2,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 45,
    "end_line": 74,
    "snippet": "\t/**\n\t * Sets the DAO for this service. This is done by DI and Spring. See the\n\t * applicationContext-service.xml definition file.\n\t * \n\t * @param dao DAO for this service\n\t */\n\tpublic void setPatientDAO(PatientDAO dao);\n\t\t\n\t/**\n\t * Saved the given <code>patient</code> to the database\n\t * \n\t * @param patient patient to be created or updated\n\t * @return patient who was created or updated\n\t * @throws APIException\n\t * <strong>Should</strong> create new patient from existing person plus user object\n\t * <strong>Should</strong> not throw a NonUniqueObjectException when called with a hand constructed patient\n\t *         regression 1375\n\t * <strong>Should</strong> fail when patient does not have any patient identifiers\n\t * <strong>Should</strong> update an existing patient\n\t * <strong>Should</strong> fail when patient does not have required patient identifiers\n\t * <strong>Should</strong> update the date changed and changed by on update of the person address\n\t * <strong>Should</strong> set the preferred name address and identifier if none is specified\n\t * <strong>Should</strong> not set the preferred name address and identifier if they already exist\n\t * <strong>Should</strong> not set a voided name or address or identifier as preferred\n\t */\n\t@Authorized( { PrivilegeConstants.ADD_PATIENTS, PrivilegeConstants.EDIT_PATIENTS })\n\tpublic Patient savePatient(Patient patient) throws APIException;\n\t\n\t/**\n\t * Get patient by internal identifier",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 3,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 67,
    "end_line": 96,
    "snippet": "\t * <strong>Should</strong> not set the preferred name address and identifier if they already exist\n\t * <strong>Should</strong> not set a voided name or address or identifier as preferred\n\t */\n\t@Authorized( { PrivilegeConstants.ADD_PATIENTS, PrivilegeConstants.EDIT_PATIENTS })\n\tpublic Patient savePatient(Patient patient) throws APIException;\n\t\n\t/**\n\t * Get patient by internal identifier\n\t * \n\t * @param patientId internal patient identifier\n\t * @return patient with given internal identifier\n\t * @throws APIException\n\t * <strong>Should</strong> return null object if patient id doesnt exist\n\t * <strong>Should</strong> fetch patient with given patient id\n\t * <strong>Should</strong> return null when patient with given patient id does not exist\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Patient getPatient(Integer patientId) throws APIException;\n\t\n\t/**\n\t * Get patient by internal identifier. If this id is for an existing person then instantiates a\n\t * new patient from that person, copying over all the fields.\n\t * \n\t * @param patientOrPersonId\n\t * @return a new unsaved patient or null if person or patient is not found\n\t * @throws APIException\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tPatient getPatientOrPromotePerson(Integer patientOrPersonId) throws APIException;\n\t",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 4,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 89,
    "end_line": 118,
    "snippet": "\t * \n\t * @param patientOrPersonId\n\t * @return a new unsaved patient or null if person or patient is not found\n\t * @throws APIException\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tPatient getPatientOrPromotePerson(Integer patientOrPersonId) throws APIException;\n\t\n\t/**\n\t * Get patient by universally unique identifier.\n\t * \n\t * @param uuid universally unique identifier\n\t * @return the patient that matches the uuid\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient with given uuid\n\t * <strong>Should</strong> return null if patient not found with given uuid\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Patient getPatientByUuid(String uuid) throws APIException;\n\t\n\t/**\n\t * Get patient identifier by universally unique identifier.\n\t * \n\t * @param uuid universally unique identifier\n\t * @return the patient identifier that matches the uuid\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier with given uuid\n\t * <strong>Should</strong> return null if patient identifier not found with given uuid\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 5,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 111,
    "end_line": 140,
    "snippet": "\t * \n\t * @param uuid universally unique identifier\n\t * @return the patient identifier that matches the uuid\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier with given uuid\n\t * <strong>Should</strong> return null if patient identifier not found with given uuid\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic PatientIdentifier getPatientIdentifierByUuid(String uuid) throws APIException;\n\t\n\t/**\n\t * Returns all non voided patients in the system\n\t * \n\t * @return non voided patients in the system\n\t * @see #getAllPatients(boolean)\n\t * @throws APIException\n\t * <strong>Should</strong> fetch all non voided patients\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getAllPatients() throws APIException;\n\t\n\t/**\n\t * Returns patients in the system\n\t * \n\t * @param includeVoided if false, will limit the search to non-voided patients\n\t * @return patients in the system\n\t * @throws APIException\n\t * <strong>Should</strong> fetch voided patients when given include voided is true\n\t * <strong>Should</strong> fetch non voided patients when given include voided is false\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 6,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 133,
    "end_line": 162,
    "snippet": "\t * Returns patients in the system\n\t * \n\t * @param includeVoided if false, will limit the search to non-voided patients\n\t * @return patients in the system\n\t * @throws APIException\n\t * <strong>Should</strong> fetch voided patients when given include voided is true\n\t * <strong>Should</strong> fetch non voided patients when given include voided is false\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getAllPatients(boolean includeVoided) throws APIException;\n\t\t\n\t/**\n\t * Get patients based on given criteria The identifier is matched with the regex\n\t * <code>OpenmrsConstants.PATIENT_IDENTIFIER_REGEX</code> All parameters are optional and\n\t * nullable. If null, it is not included in the search. Will not return voided patients\n\t * \n\t * @param name (optional) this is a slight break from the norm, patients with a partial match on\n\t *            this name will be returned\n\t * @param identifier (optional) only patients with a matching identifier are returned. This\n\t * \t\t\t  however applies only if <code>name</code> argument is null. Otherwise, its \n\t * \t\t\t  ignored.\t\n\t * @param identifierTypes (optional) the PatientIdentifierTypes to restrict to\n\t * @param matchIdentifierExactly (required) if true, then the given <code>identifier</code> must\n\t *            equal the id in the database. if false, then the identifier is 'searched' for by\n\t *            using a regular expression\n\t * @return patients that matched the given criteria (and are not voided)\n\t * @throws APIException\n\t * <strong>Should</strong> fetch all patients that partially match given name\n\t * <strong>Should</strong> fetch all patients that partially match given identifier if <code>name</code> argument\n\t * \t\t   is null",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 7,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 155,
    "end_line": 184,
    "snippet": "\t * @param matchIdentifierExactly (required) if true, then the given <code>identifier</code> must\n\t *            equal the id in the database. if false, then the identifier is 'searched' for by\n\t *            using a regular expression\n\t * @return patients that matched the given criteria (and are not voided)\n\t * @throws APIException\n\t * <strong>Should</strong> fetch all patients that partially match given name\n\t * <strong>Should</strong> fetch all patients that partially match given identifier if <code>name</code> argument\n\t * \t\t   is null\n\t * <strong>Should</strong> fetch all patients that partially match given identifier when match identifier\n\t *         exactly equals false and if <code>name</code> argument is null\n\t * <strong>Should</strong> fetch all patients that exactly match given identifier when match identifier exactly\n\t *         equals true and if <code>name</code> argument is null\n\t * <strong>Should</strong> fetch all patients that match given identifier types\n\t * <strong>Should</strong> not return duplicates\n\t * <strong>Should</strong> not return voided patients\n\t * <strong>Should</strong> return empty list when no match is found\n\t * <strong>Should</strong> search familyName2 with name\n\t * <strong>Should</strong> support simple regex\n\t * <strong>Should</strong> support pattern using last digit as check digit\n\t * <strong>Should</strong> return empty list if name and identifier is empty\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly) throws APIException;\n\t\n\t/**\n\t * Void patient record (functionally delete patient from system). Voids Person and retires\n\t * Users.\n\t * \n\t * @param patient patient to be voided",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 8,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 177,
    "end_line": 206,
    "snippet": "\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly) throws APIException;\n\t\n\t/**\n\t * Void patient record (functionally delete patient from system). Voids Person and retires\n\t * Users.\n\t * \n\t * @param patient patient to be voided\n\t * @param reason reason for voiding patient\n\t * @return the voided patient\n\t * <strong>Should</strong> void given patient with given reason\n\t * <strong>Should</strong> void all patient identifiers associated with given patient\n\t * <strong>Should</strong> return voided patient with given reason\n\t * <strong>Should</strong> return null when patient is null\n\t * <strong>Should</strong> void person\n\t * <strong>Should</strong> retire users\n\t */\n\t@Authorized( { PrivilegeConstants.DELETE_PATIENTS })\n\tpublic Patient voidPatient(Patient patient, String reason) throws APIException;\n\t\n\t/**\n\t * Unvoid patient record. Unvoids Person as well.\n\t * \n\t * @param patient patient to be revived\n\t * @return the revived Patient\n\t * <strong>Should</strong> unvoid given patient\n\t * <strong>Should</strong> return unvoided patient\n\t * <strong>Should</strong> unvoid person\n\t * <strong>Should</strong> not unretire users\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 9,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 199,
    "end_line": 228,
    "snippet": "\t * \n\t * @param patient patient to be revived\n\t * @return the revived Patient\n\t * <strong>Should</strong> unvoid given patient\n\t * <strong>Should</strong> return unvoided patient\n\t * <strong>Should</strong> unvoid person\n\t * <strong>Should</strong> not unretire users\n\t */\n\t@Authorized( { PrivilegeConstants.DELETE_PATIENTS })\n\tpublic Patient unvoidPatient(Patient patient) throws APIException;\n\t\t\n\t/**\n\t * Delete patient from database. This <b>should not be called</b> except for testing and\n\t * administration purposes. Use the void method instead.\n\t * \n\t * @param patient patient to be deleted\n\t * @throws APIException\n\t * @see #voidPatient(org.openmrs.Patient,java.lang.String)\n\t * <strong>Should</strong> delete patient from database\n\t */\n\t@Authorized( { PrivilegeConstants.PURGE_PATIENTS })\n\tpublic void purgePatient(Patient patient) throws APIException;\n\t\t\n\t/**\n\t * Get all patientIdentifiers that match all of the given criteria Voided identifiers are not\n\t * returned\n\t * \n\t * @param identifier the full identifier to match on\n\t * @param patientIdentifierTypes the type of identifiers to get\n\t * @param locations the locations of the identifiers to match",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 10,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 221,
    "end_line": 250,
    "snippet": "\t\t\n\t/**\n\t * Get all patientIdentifiers that match all of the given criteria Voided identifiers are not\n\t * returned\n\t * \n\t * @param identifier the full identifier to match on\n\t * @param patientIdentifierTypes the type of identifiers to get\n\t * @param locations the locations of the identifiers to match\n\t * @param patients the patients containing these identifiers\n\t * @param isPreferred if true, limits to only preferred identifiers if false, only non\n\t *            preferred. if null, ignores preferred status\n\t * @return PatientIdentifiers matching these criteria\n\t * <strong>Should</strong> return only non voided patients and patient identifiers\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifiers that exactly matches given identifier\n\t * <strong>Should</strong> not fetch patient identifiers that partially matches given identifier\n\t * <strong>Should</strong> fetch patient identifiers that match given patient identifier types\n\t * <strong>Should</strong> fetch patient identifiers that match given locations\n\t * <strong>Should</strong> fetch patient identifiers that match given patients\n\t * <strong>Should</strong> fetch preferred patient identifiers when given is preferred equals true\n\t * <strong>Should</strong> fetch non preferred patient identifiers when given is preferred equals false\n\t * <strong>Should</strong> fetch preferred and non preferred patient identifiers when given is preferred is null\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic List<PatientIdentifier> getPatientIdentifiers(String identifier,\n\t        List<PatientIdentifierType> patientIdentifierTypes, List<Location> locations, List<Patient> patients,\n\t        Boolean isPreferred) throws APIException;\n\t\t\n\t/**\n\t * Create or update a PatientIdentifierType",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 11,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 243,
    "end_line": 272,
    "snippet": "\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic List<PatientIdentifier> getPatientIdentifiers(String identifier,\n\t        List<PatientIdentifierType> patientIdentifierTypes, List<Location> locations, List<Patient> patients,\n\t        Boolean isPreferred) throws APIException;\n\t\t\n\t/**\n\t * Create or update a PatientIdentifierType\n\t * \n\t * @param patientIdentifierType PatientIdentifierType to create or update\n\t * @return the saved type\n\t * @throws APIException\n\t * <strong>Should</strong> create new patient identifier type\n\t * <strong>Should</strong> update existing patient identifier type\n\t * <strong>Should</strong> throw error when trying to save a patient identifier type while patient identifier\n\t *         types are locked\n\t */\n\t@Authorized( { PrivilegeConstants.MANAGE_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType savePatientIdentifierType(PatientIdentifierType patientIdentifierType) throws APIException;\n\t\t\n\t/**\n\t * Get all patientIdentifier types\n\t * <p>\n\t * Ordered same as {@link PatientIdentifierTypeDefaultComparator}.\n\t * \n\t * @return patientIdentifier types list\n\t * @throws APIException\n\t * <strong>Should</strong> fetch all non retired patient identifier types\n\t * <strong>Should</strong> order as default comparator\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 12,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 265,
    "end_line": 294,
    "snippet": "\t * <p>\n\t * Ordered same as {@link PatientIdentifierTypeDefaultComparator}.\n\t * \n\t * @return patientIdentifier types list\n\t * @throws APIException\n\t * <strong>Should</strong> fetch all non retired patient identifier types\n\t * <strong>Should</strong> order as default comparator\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes() throws APIException;\n\t\n\t/**\n\t * Get all patientIdentifier types.\n\t * <p>\n\t * Ordered same as {@link PatientIdentifierTypeDefaultComparator}.\n\t * \n\t * @param includeRetired true/false whether retired types should be included\n\t * @return patientIdentifier types list\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier types including retired when include retired is true\n\t * <strong>Should</strong> fetch patient identifier types excluding retired when include retired is false\n\t * <strong>Should</strong> order as default comparator\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes(boolean includeRetired) throws APIException;\n\t\n\t/**\n\t * Get all patientIdentifier types that match the given criteria\n\t * <p>\n\t * Ordered same as {@link PatientIdentifierTypeDefaultComparator}.",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 13,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 287,
    "end_line": 316,
    "snippet": "\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes(boolean includeRetired) throws APIException;\n\t\n\t/**\n\t * Get all patientIdentifier types that match the given criteria\n\t * <p>\n\t * Ordered same as {@link PatientIdentifierTypeDefaultComparator}.\n\t * \n\t * @param name name of the type to match on\n\t * @param format the string format to match on\n\t * @param required if true, limits to only identifiers marked as required if false, only non\n\t *            required. if null, ignores required bit\n\t * @param hasCheckDigit if true, limits to only check digit'd identifiers if false, only non\n\t *            checkdigit'd. if null, ignores checkDigit\n\t * @return patientIdentifier types list\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier types that match given name with given format\n\t * <strong>Should</strong> fetch required patient identifier types when given required is true\n\t * <strong>Should</strong> fetch non required patient identifier types when given required is false\n\t * <strong>Should</strong> fetch any patient identifier types when given required is null\n\t * <strong>Should</strong> fetch patient identifier types with check digit when given has check digit is true\n\t * <strong>Should</strong> fetch patient identifier types without check digit when given has check digit is\n\t *         false\n\t * <strong>Should</strong> fetch any patient identifier types when given has check digit is null\n\t * <strong>Should</strong> order as default comparator\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic List<PatientIdentifierType> getPatientIdentifierTypes(String name, String format, Boolean required,\n\t        Boolean hasCheckDigit) throws APIException;",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 14,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 309,
    "end_line": 338,
    "snippet": "\t * <strong>Should</strong> fetch patient identifier types without check digit when given has check digit is\n\t *         false\n\t * <strong>Should</strong> fetch any patient identifier types when given has check digit is null\n\t * <strong>Should</strong> order as default comparator\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic List<PatientIdentifierType> getPatientIdentifierTypes(String name, String format, Boolean required,\n\t        Boolean hasCheckDigit) throws APIException;\n\t\n\t/**\n\t * Get patientIdentifierType by internal identifier\n\t * \n\t * @param patientIdentifierTypeId\n\t * @return patientIdentifierType with specified internal identifier\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier with given patient identifier type id\n\t * <strong>Should</strong> return null when patient identifier identifier does not exist\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType getPatientIdentifierType(Integer patientIdentifierTypeId) throws APIException;\n\t\n\t/**\n\t * Get patient identifierType by universally unique identifier\n\t * \n\t * @param uuid\n\t * @return patientIdentifierType with specified internal identifier\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier type with given uuid\n\t * <strong>Should</strong> return null when patient identifier type with given uuid does not exist\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 15,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 331,
    "end_line": 360,
    "snippet": "\t * Get patient identifierType by universally unique identifier\n\t * \n\t * @param uuid\n\t * @return patientIdentifierType with specified internal identifier\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier type with given uuid\n\t * <strong>Should</strong> return null when patient identifier type with given uuid does not exist\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType getPatientIdentifierTypeByUuid(String uuid) throws APIException;\n\t\t\n\t/**\n\t * Get patientIdentifierType by exact name\n\t * \n\t * @param name\n\t * @return patientIdentifierType with given name\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patient identifier type that exactly matches given name\n\t * <strong>Should</strong> not return patient identifier type that partially matches given name\n\t * <strong>Should</strong> return null when patient identifier type with given name does not exist\n\t */\n\t@Authorized( { PrivilegeConstants.GET_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType getPatientIdentifierTypeByName(String name) throws APIException;\n\t\n\t/**\n\t * Retire a type of patient identifier\n\t * \n\t * @param patientIdentifierType type of patient identifier to be retired\n\t * @param reason the reason to retire this identifier type\n\t * @return the retired type",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 16,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 353,
    "end_line": 382,
    "snippet": "\tpublic PatientIdentifierType getPatientIdentifierTypeByName(String name) throws APIException;\n\t\n\t/**\n\t * Retire a type of patient identifier\n\t * \n\t * @param patientIdentifierType type of patient identifier to be retired\n\t * @param reason the reason to retire this identifier type\n\t * @return the retired type\n\t * @throws APIException\n\t * <strong>Should</strong> retire patient identifier type with given reason\n\t * <strong>Should</strong> throw error when reason is empty\n\t * <strong>Should</strong> throw error when trying to retire a patient identifier type while patient identifier\n\t *         types are locked\n\t */\n\t@Authorized( { PrivilegeConstants.MANAGE_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType retirePatientIdentifierType(PatientIdentifierType patientIdentifierType, String reason)\n\t        throws APIException;\n\t\n\t/**\n\t * Unretire a type of patient identifier\n\t * \n\t * @param patientIdentifierType type of patient identifier to be unretired\n\t * @return the unretired type\n\t * @throws APIException\n\t * <strong>Should</strong> unretire patient identifier type\n\t * <strong>Should</strong> return unretired patient identifier type\n\t * <strong>Should</strong> throw error when trying to unretire a patient identifier type while patient\n\t *         identifier types are locked\n\t */\n\t@Authorized( { PrivilegeConstants.MANAGE_IDENTIFIER_TYPES })",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 17,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 375,
    "end_line": 404,
    "snippet": "\t * @return the unretired type\n\t * @throws APIException\n\t * <strong>Should</strong> unretire patient identifier type\n\t * <strong>Should</strong> return unretired patient identifier type\n\t * <strong>Should</strong> throw error when trying to unretire a patient identifier type while patient\n\t *         identifier types are locked\n\t */\n\t@Authorized( { PrivilegeConstants.MANAGE_IDENTIFIER_TYPES })\n\tpublic PatientIdentifierType unretirePatientIdentifierType(PatientIdentifierType patientIdentifierType)\n\t        throws APIException;\n\t\n\t/**\n\t * Purge PatientIdentifierType (cannot be undone)\n\t * \n\t * @param patientIdentifierType PatientIdentifierType to purge from the database\n\t * @throws APIException\n\t * <strong>Should</strong> delete type from database\n\t * <strong>Should</strong> delete patient identifier type from database\n\t * <strong>Should</strong> throw error when trying to delete a patient identifier type while patient identifier\n\t *         types are locked\n\t */\n\t@Authorized( { PrivilegeConstants.PURGE_IDENTIFIER_TYPES })\n\tpublic void purgePatientIdentifierType(PatientIdentifierType patientIdentifierType) throws APIException;\n\t\t\n\t/**\n\t * Convenience method to validate all identifiers for a given patient\n\t * \n\t * @param patient patient for which to validate identifiers\n\t * @see #checkPatientIdentifiers(Patient)\n\t * @throws PatientIdentifierException if one or more of the identifiers are invalid",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 18,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 397,
    "end_line": 426,
    "snippet": "\tpublic void purgePatientIdentifierType(PatientIdentifierType patientIdentifierType) throws APIException;\n\t\t\n\t/**\n\t * Convenience method to validate all identifiers for a given patient\n\t * \n\t * @param patient patient for which to validate identifiers\n\t * @see #checkPatientIdentifiers(Patient)\n\t * @throws PatientIdentifierException if one or more of the identifiers are invalid\n\t * <strong>Should</strong> validate when patient has all required and no duplicate and no blank patient\n\t *         identifiers\n\t * <strong>Should</strong> ignore voided patient identifier\n\t * <strong>Should</strong> remove identifier and throw error when patient has blank patient identifier\n\t * <strong>Should</strong> throw error when patient has null patient identifiers\n\t * <strong>Should</strong> throw error when patient has empty patient identifiers\n\t * <strong>Should</strong> throw error when patient has identical identifiers\n\t * <strong>Should</strong> throw error when patient does not have one or more required identifiers\n\t * <strong>Should</strong> require one non voided patient identifier\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic void checkPatientIdentifiers(Patient patient) throws PatientIdentifierException;\n\t\t\n\t/**\n\t * Generic search on patients based on the given string. Implementations can use this string to\n\t * search on name, identifier, etc Voided patients are not returned in search results\n\t * \n\t * @param query the string to search on\n\t * @return a list of matching Patients\n\t * <strong>Should</strong> force search string to be greater than minsearchcharacters global property\n\t * <strong>Should</strong> allow search string to be one according to minsearchcharacters global property\n\t * <strong>Should</strong> fetch patients with patient identifiers matching given query",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 19,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 419,
    "end_line": 448,
    "snippet": "\t * Generic search on patients based on the given string. Implementations can use this string to\n\t * search on name, identifier, etc Voided patients are not returned in search results\n\t * \n\t * @param query the string to search on\n\t * @return a list of matching Patients\n\t * <strong>Should</strong> force search string to be greater than minsearchcharacters global property\n\t * <strong>Should</strong> allow search string to be one according to minsearchcharacters global property\n\t * <strong>Should</strong> fetch patients with patient identifiers matching given query\n\t * <strong>Should</strong> fetch patients with any name matching given query\n\t * <strong>Should</strong> return empty list if given query length less than minimum search characters\n\t * <strong>Should</strong> not fail when minimum search characters is null\n\t * <strong>Should</strong> not fail when minimum search characters is invalid integer\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String query) throws APIException;\n\t\n\t/**\n\t * Generic search on patients based on the given string and returns a specific number of them\n\t * from the specified starting position. Implementations can use this string to search on name,\n\t * identifier, searchable person attributes etc. Voided patients are not returned in search\n\t * results. If start is 0 and length is not specified, then all matches are returned\n\t * \n\t * @param query the string to search on\n\t * @param start the starting index\n\t * @param length the number of patients to return\n\t * @return a list of matching Patients\n\t * @throws APIException\n\t * @since 1.8\n\t * <strong>Should</strong> find a patients with a matching identifier with no digits\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 20,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 441,
    "end_line": 470,
    "snippet": "\t * @param query the string to search on\n\t * @param start the starting index\n\t * @param length the number of patients to return\n\t * @return a list of matching Patients\n\t * @throws APIException\n\t * @since 1.8\n\t * <strong>Should</strong> find a patients with a matching identifier with no digits\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String query, Integer start, Integer length) throws APIException;\n\t\n\t/**\n\t * @param query the string to search on\n\t * @param includeVoided true/false whether or not to included voided patients\n\t * @param start the starting index\n\t * @param length the number of patients to return\n\t * @return a list of matching Patients\n\t * @throws APIException\n\t * @since 1.11\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String query, boolean includeVoided, Integer start, Integer length) throws APIException;\n\t\t\n\t/**\n\t * This method tries to find a patient in the database given the attributes on the given\n\t * <code>patientToMatch</code> object. Assumes there could be a PersonAttribute on this Patient\n\t * with PersonAttributeType.name = \"Other Matching Information\". This PersonAttribute has a\n\t * \"value\" that is just key value pairs in the form of key:value;nextkey:nextvalue;\n\t * \n\t * @param patientToMatch",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 21,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 463,
    "end_line": 492,
    "snippet": "\t\t\n\t/**\n\t * This method tries to find a patient in the database given the attributes on the given\n\t * <code>patientToMatch</code> object. Assumes there could be a PersonAttribute on this Patient\n\t * with PersonAttributeType.name = \"Other Matching Information\". This PersonAttribute has a\n\t * \"value\" that is just key value pairs in the form of key:value;nextkey:nextvalue;\n\t * \n\t * @param patientToMatch\n\t * @return null if no match found, a fresh patient object from the db if is found\n\t * <strong>Should</strong> fetch patient matching patient id of given patient\n\t * <strong>Should</strong> not fetch patient matching any other patient information\n\t * <strong>Should</strong> return null when no patient matches given patient to match\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Patient getPatientByExample(Patient patientToMatch) throws APIException;\n\t\t\n\t/**\n\t * Search the database for patients that both share the given attributes. Each attribute that is\n\t * passed in must be identical to what is stored for at least one other patient for both\n\t * patients to be returned.\n\t * \n\t * @param attributes attributes on a Person or Patient object. similar to: [gender, givenName,\n\t *            middleName, familyName]\n\t * @return list of patients that match other patients\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patients that exactly match on all given attributes\n\t * <strong>Should</strong> not return patients that exactly match on some but not all given attributes\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getDuplicatePatientsByAttributes(List<String> attributes) throws APIException;",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 22,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 485,
    "end_line": 514,
    "snippet": "\t *            middleName, familyName]\n\t * @return list of patients that match other patients\n\t * @throws APIException\n\t * <strong>Should</strong> fetch patients that exactly match on all given attributes\n\t * <strong>Should</strong> not return patients that exactly match on some but not all given attributes\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getDuplicatePatientsByAttributes(List<String> attributes) throws APIException;\n\t\n\t/**\n\t * Convenience method to join two patients' information into one record.\n\t * <ol>\n\t * <li>Moves object (encounters/obs) pointing to <code>nonPreferred</code> to point at\n\t * <code>preferred</code></li>\n\t * <li>Copies data (gender/birthdate/names/ids/etc) from <code>nonPreferred</code> to\n\t * <code>preferred</code> IFF the data is missing or null in <code>preferred</code></li>\n\t * <li><code>notPreferred</code> is marked as voided</li>\n\t * </ol>\n\t * \n\t * @param preferred The Patient to merge to\n\t * @param notPreferred The Patient to merge from (and then void)\n\t * @throws APIException\n\t * @throws SerializationException\n\t * @see PersonMergeLogData\n\t * <strong>Should</strong> not merge the same patient to itself\n\t * <strong>Should</strong> copy nonvoided names to preferred patient\n\t * <strong>Should</strong> copy nonvoided identifiers to preferred patient\n\t * <strong>Should</strong> copy nonvoided addresses to preferred patient\n\t * <strong>Should</strong> not copy over relationships that are only between the preferred and notpreferred\n\t *         patient",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 23,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 507,
    "end_line": 536,
    "snippet": "\t * @throws SerializationException\n\t * @see PersonMergeLogData\n\t * <strong>Should</strong> not merge the same patient to itself\n\t * <strong>Should</strong> copy nonvoided names to preferred patient\n\t * <strong>Should</strong> copy nonvoided identifiers to preferred patient\n\t * <strong>Should</strong> copy nonvoided addresses to preferred patient\n\t * <strong>Should</strong> not copy over relationships that are only between the preferred and notpreferred\n\t *         patient\n\t * <strong>Should</strong> not merge patient with itself\n\t * <strong>Should</strong> not create duplicate relationships\n\t * <strong>Should</strong> merge encounters from non preferred to preferred patient\n\t * <strong>Should</strong> merge visits from non preferred to preferred patient\n\t * <strong>Should</strong> merge non duplicate patient identifiers from non preferred to preferred patient\n\t * <strong>Should</strong> merge non duplicate patient names from non preferred to preferred patient\n\t * <strong>Should</strong> merge non duplicate addresses from non preferred to preferred patient\n\t * <strong>Should</strong> merge non voided patient programs from non preferred to preferred patient\n\t * <strong>Should</strong> merge non voided relationships from non preferred to preferred patient\n\t * <strong>Should</strong> merge observations associated with encounters from non preferred to preferred patient\n\t * <strong>Should</strong> merge non voided person attributes from non preferred to preferred patient\n\t * <strong>Should</strong> merge other non voided observations from non preferred to preferred patient\n\t * <strong>Should</strong> merge other non voided orders from non preferred to preferred patient\n\t * <strong>Should</strong> merge non preferred death date when preferred death date is not null or empty\n\t * <strong>Should</strong> merge non preferred death cause when preferred death cause is not null or empty\n\t * <strong>Should</strong> void non preferred person object\n\t * <strong>Should</strong> change user records of non preferred person to preferred person\n\t * <strong>Should</strong> void non preferred patient\n\t * <strong>Should</strong> void all relationships for non preferred patient\n\t * <strong>Should</strong> not void relationships for same type and side with different relatives\n\t * <strong>Should</strong> audit moved encounters\n\t * <strong>Should</strong> audit moved visits",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 24,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 529,
    "end_line": 558,
    "snippet": "\t * <strong>Should</strong> merge non preferred death cause when preferred death cause is not null or empty\n\t * <strong>Should</strong> void non preferred person object\n\t * <strong>Should</strong> change user records of non preferred person to preferred person\n\t * <strong>Should</strong> void non preferred patient\n\t * <strong>Should</strong> void all relationships for non preferred patient\n\t * <strong>Should</strong> not void relationships for same type and side with different relatives\n\t * <strong>Should</strong> audit moved encounters\n\t * <strong>Should</strong> audit moved visits\n\t * <strong>Should</strong> audit created patient programs\n\t * <strong>Should</strong> audit voided relationships\n\t * <strong>Should</strong> audit created relationships\n\t * <strong>Should</strong> audit moved independent observations\n\t * <strong>Should</strong> audit created identifiers\n\t * <strong>Should</strong> audit created names\n\t * <strong>Should</strong> audit created addresses\n\t * <strong>Should</strong> audit created attributes\n\t * <strong>Should</strong> audit moved users\n\t * <strong>Should</strong> audit prior cause of death\n\t * <strong>Should</strong> audit prior date of death\n\t * <strong>Should</strong> audit prior date of birth\n\t * <strong>Should</strong> audit prior date of birth estimated\n\t * <strong>Should</strong> audit prior gender\n\t * <strong>Should</strong> not copy over duplicate patient identifiers\n\t * <strong>Should</strong> fail if not preferred patient has unvoided orders\n\t */\n\t@Authorized( { PrivilegeConstants.EDIT_PATIENTS })\n\tpublic void mergePatients(Patient preferred, Patient notPreferred) throws APIException, SerializationException;\n\t\n\t/**\n\t * Convenience method to join multiple patients' information into one record.",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 25,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 551,
    "end_line": 580,
    "snippet": "\t * <strong>Should</strong> not copy over duplicate patient identifiers\n\t * <strong>Should</strong> fail if not preferred patient has unvoided orders\n\t */\n\t@Authorized( { PrivilegeConstants.EDIT_PATIENTS })\n\tpublic void mergePatients(Patient preferred, Patient notPreferred) throws APIException, SerializationException;\n\t\n\t/**\n\t * Convenience method to join multiple patients' information into one record.\n\t * \n\t * @param preferred\n\t * @param notPreferred\n\t * @throws APIException\n\t * @throws SerializationException\n\t * <strong>Should</strong> merge all non Preferred patients in the the notPreferred list to preferred patient\n\t */\n\tpublic void mergePatients(Patient preferred, List<Patient> notPreferred) throws APIException, SerializationException;\n\t\t\n\t/**\n\t * Convenience method to establish that a patient has died. In addition to exiting the patient\n\t * from care (see above), this method will also set the appropriate patient characteristics to\n\t * indicate that they have died, when they died, etc.\n\t * \n\t * @param patient - the patient who has died\n\t * @param dateDied - the declared date/time of the patient's death\n\t * @param causeOfDeath - the concept that corresponds with the reason the patient died\n\t * @param otherReason - if the concept representing the reason is OTHER NON-CODED, and a\n\t *            string-based \"other\" reason is supplied\n\t * @throws APIException\n\t * <strong>Should</strong> throw API exception if patient is null \n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 26,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 573,
    "end_line": 602,
    "snippet": "\t * @param patient - the patient who has died\n\t * @param dateDied - the declared date/time of the patient's death\n\t * @param causeOfDeath - the concept that corresponds with the reason the patient died\n\t * @param otherReason - if the concept representing the reason is OTHER NON-CODED, and a\n\t *            string-based \"other\" reason is supplied\n\t * @throws APIException\n\t * <strong>Should</strong> throw API exception if patient is null \n\t */\n\t@Authorized( { PrivilegeConstants.EDIT_PATIENTS })\n\tpublic void processDeath(Patient patient, Date dateDied, Concept causeOfDeath, String otherReason) throws APIException;\n\t\n\t/**\n\t * Convenience method that saves the Obs that indicates when and why the patient died (including\n\t * any \"other\" reason there might be)\n\t * \n\t * @param patient - the patient who has died\n\t * @param dateDied - the declared date/time of the patient's death\n\t * @param causeOfDeath - the concept that corresponds with the reason the patient died\n\t * @param otherReason - if the concept representing the reason is OTHER NON-CODED, and a\n\t *            string-based \"other\" reason is supplied\n\t * @throws APIException\n\t * <strong>Should</strong> throw error when given patient is null\n\t * <strong>Should</strong> throw error when given death date is null\n\t * <strong>Should</strong> throw error when given cause is null is null\n\t * <strong>Should</strong> throw error when cause of death global property is not specified\n\t * <strong>Should</strong> throw error when patient already has more than one cause of death observations\n\t * <strong>Should</strong> modify existing cause of death observation\n\t * <strong>Should</strong> set death attributes as long as patient is not already dead\n\t * <strong>Should</strong> be tested more thoroughly\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 27,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 595,
    "end_line": 624,
    "snippet": "\t * <strong>Should</strong> throw error when given death date is null\n\t * <strong>Should</strong> throw error when given cause is null is null\n\t * <strong>Should</strong> throw error when cause of death global property is not specified\n\t * <strong>Should</strong> throw error when patient already has more than one cause of death observations\n\t * <strong>Should</strong> modify existing cause of death observation\n\t * <strong>Should</strong> set death attributes as long as patient is not already dead\n\t * <strong>Should</strong> be tested more thoroughly\n\t */\n\t@Authorized(value = { PrivilegeConstants.GET_PATIENTS, PrivilegeConstants.EDIT_OBS }, requireAll = true)\n\tpublic void saveCauseOfDeathObs(Patient patient, Date dateDied, Concept causeOfDeath, String otherReason)\n\t        throws APIException;\n\t\n\t/**\n\t * Gets an identifier validator matching the given class.\n\t * \n\t * @param clazz identifierValidator which validator to get.\n\t * <strong>Should</strong> return patient identifier validator given class\n\t */\n\tpublic IdentifierValidator getIdentifierValidator(Class<IdentifierValidator> clazz);\n\t\n\t/**\n\t * <strong>Should</strong> return patient identifier validator given class name\n\t * <strong>Should</strong> treat empty strings like a null entry\n\t */\n\tpublic IdentifierValidator getIdentifierValidator(String pivClassName);\n\t\n\t/**\n\t * @return the default IdentifierValidator\n\t * <strong>Should</strong> return default patient identifier validator\n\t */",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 28,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 617,
    "end_line": 646,
    "snippet": "\t * <strong>Should</strong> treat empty strings like a null entry\n\t */\n\tpublic IdentifierValidator getIdentifierValidator(String pivClassName);\n\t\n\t/**\n\t * @return the default IdentifierValidator\n\t * <strong>Should</strong> return default patient identifier validator\n\t */\n\tpublic IdentifierValidator getDefaultIdentifierValidator();\n\t\n\t/**\n\t * @return All registered PatientIdentifierValidators\n\t * <strong>Should</strong> return all registered patient identifier validators\n\t */\n\tpublic Collection<IdentifierValidator> getAllIdentifierValidators();\n\t\n\t/**\n\t * Checks whether the given patient identifier is already assigned to a patient other than\n\t * patientIdentifier.patient\n\t * \n\t * @param patientIdentifier the patient identifier to look for in other patients\n\t * @return whether or not the identifier is in use by a patient other than\n\t *         patientIdentifier.patient\n\t * <strong>Should</strong> return true when patientIdentifier contains a patient and another patient has this id\n\t * <strong>Should</strong> return false when patientIdentifier contains a patient and no other patient has this\n\t *         id\n\t * <strong>Should</strong> return true when patientIdentifier does not contain a patient and a patient has this\n\t *         id\n\t * <strong>Should</strong> return false when patientIdentifier does not contain a patient and no patient has\n\t *         this id",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 29,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 639,
    "end_line": 668,
    "snippet": "\t *         patientIdentifier.patient\n\t * <strong>Should</strong> return true when patientIdentifier contains a patient and another patient has this id\n\t * <strong>Should</strong> return false when patientIdentifier contains a patient and no other patient has this\n\t *         id\n\t * <strong>Should</strong> return true when patientIdentifier does not contain a patient and a patient has this\n\t *         id\n\t * <strong>Should</strong> return false when patientIdentifier does not contain a patient and no patient has\n\t *         this id\n\t * <strong>Should</strong> ignore voided patientIdentifiers\n\t * <strong>Should</strong> ignore voided patients\n\t * <strong>Should</strong> return true if in use for a location and id type uniqueness is set to location\n\t * <strong>Should</strong> return false if in use for another location and id uniqueness is set to location\n\t * <strong>Should</strong> return true if in use and id type uniqueness is set to unique\n\t * <strong>Should</strong> return true if in use and id type uniqueness is null\n\t */\n\t@Authorized(PrivilegeConstants.GET_PATIENTS)\n\tpublic boolean isIdentifierInUseByAnotherPatient(PatientIdentifier patientIdentifier);\n\t\n\t/**\n\t * Returns a patient identifier that matches the given patientIndentifier id\n\t * \n\t * @param patientIdentifierId the patientIdentifier id\n\t * @return the patientIdentifier matching the Id\n\t * @throws APIException\n\t * <strong>Should</strong> return the patientIdentifier with the given id\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic PatientIdentifier getPatientIdentifier(Integer patientIdentifierId) throws APIException;\n\t\n\t/**",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 30,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 661,
    "end_line": 690,
    "snippet": "\t * @return the patientIdentifier matching the Id\n\t * @throws APIException\n\t * <strong>Should</strong> return the patientIdentifier with the given id\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENT_IDENTIFIERS })\n\tpublic PatientIdentifier getPatientIdentifier(Integer patientIdentifierId) throws APIException;\n\t\n\t/**\n\t * Void patient identifier (functionally delete patient identifier from system)\n\t * \n\t * @param patientIdentifier patientIdentifier to be voided\n\t * @param reason reason for voiding patient identifier\n\t * @return the voided patient identifier\n\t * @throws APIException\n\t * <strong>Should</strong> void given patient identifier with given reaso\n\t * <strong>Should</strong> throw an APIException if the reason is null\n\t * <strong>Should</strong> throw an APIException if the reason is an empty string\n\t * <strong>Should</strong> throw an APIException if the reason is a white space character\n\t */\n\t@Authorized( { PrivilegeConstants.DELETE_PATIENT_IDENTIFIERS })\n\tpublic PatientIdentifier voidPatientIdentifier(PatientIdentifier patientIdentifier, String reason) throws APIException;\n\t\n\t/**\n\t * Saved the given <code>patientIndentifier</code> to the database\n\t * \n\t * @param patientIdentifier patientIndentifier to be created or updated\n\t * @return patientIndentifier that was created or updated\n\t * @throws APIException\n\t * <strong>Should</strong> create new patientIndentifier\n\t * <strong>Should</strong> update an existing patient identifier",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 31,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 683,
    "end_line": 712,
    "snippet": "\t/**\n\t * Saved the given <code>patientIndentifier</code> to the database\n\t * \n\t * @param patientIdentifier patientIndentifier to be created or updated\n\t * @return patientIndentifier that was created or updated\n\t * @throws APIException\n\t * <strong>Should</strong> create new patientIndentifier\n\t * <strong>Should</strong> update an existing patient identifier\n\t * <strong>Should</strong> throw an APIException when a null argument is passed\n\t * <strong>Should</strong> throw an APIException when one of the required fields is null\n\t * <strong>Should</strong> throw an APIException if the patientIdentifier string is a white space\n\t * <strong>Should</strong> throw an APIException if the patientIdentifier string is an empty string\n\t */\n\t@Authorized( { PrivilegeConstants.ADD_PATIENT_IDENTIFIERS, PrivilegeConstants.EDIT_PATIENT_IDENTIFIERS })\n\tpublic PatientIdentifier savePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException;\n\t\n\t/**\n\t * Purge PatientIdentifier (cannot be undone)\n\t * \n\t * @param patientIdentifier PatientIdentifier to purge from the database\n\t * @throws APIException\n\t * <strong>Should</strong> delete patient identifier from database\n\t */\n\t@Authorized( { PrivilegeConstants.PURGE_PATIENT_IDENTIFIERS })\n\tpublic void purgePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException;\n\t\n\t/**\n\t * Gets allergies for a given patient\n\t * \n\t * @param patient the patient",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 32,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 705,
    "end_line": 734,
    "snippet": "\t */\n\t@Authorized( { PrivilegeConstants.PURGE_PATIENT_IDENTIFIERS })\n\tpublic void purgePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException;\n\t\n\t/**\n\t * Gets allergies for a given patient\n\t * \n\t * @param patient the patient\n\t * @return the allergies object\n\t * <strong>Should</strong> get the allergy list and status\n\t */\n\tAllergies getAllergies(Patient patient);\n\t\n\t/**\n\t * Updates the patient's allergies\n\t * \n\t * @param patient the patient\n\t * @param allergies the allergies\n\t * @return the saved allergies\n\t * <strong>Should</strong> save the allergy list and status\n\t * <strong>Should</strong> void removed allergies and maintain status as see list if some allergies are removed\n\t * <strong>Should</strong> void all allergies and set status to unknown if all allergies are removed\n\t * <strong>Should</strong> set status to no known allergies for patient without allergies\n\t * <strong>Should</strong> void all allergies and set status to no known allergies if all allergies are removed and status set as such\n\t * <strong>Should</strong> void allergies with edited comment\n\t * <strong>Should</strong> void allergies with edited severity\n\t * <strong>Should</strong> void allergies with edited coded allergen\n\t * <strong>Should</strong> void allergies with edited non coded allergen\n\t * <strong>Should</strong> void allergies with edited reaction coded\n\t * <strong>Should</strong> void allergies with edited reaction non coded",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 33,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 727,
    "end_line": 756,
    "snippet": "\t * <strong>Should</strong> set status to no known allergies for patient without allergies\n\t * <strong>Should</strong> void all allergies and set status to no known allergies if all allergies are removed and status set as such\n\t * <strong>Should</strong> void allergies with edited comment\n\t * <strong>Should</strong> void allergies with edited severity\n\t * <strong>Should</strong> void allergies with edited coded allergen\n\t * <strong>Should</strong> void allergies with edited non coded allergen\n\t * <strong>Should</strong> void allergies with edited reaction coded\n\t * <strong>Should</strong> void allergies with edited reaction non coded\n\t * <strong>Should</strong> void allergies with removed reactions\n\t * <strong>Should</strong> void allergies with added reactions\n     * <strong>Should</strong> set the non coded concept for non coded allergen if not specified\n\t */\n\tAllergies setAllergies(Patient patient, Allergies allergies);\n\t\n\t/**\n\t * Returns the Allergy identified by internal Ingerger Id\n\t * \n\t * @param allergyListId identifies allergy by internal Ingerger Id\n\t * @return the allergy\n\t * @throws APIException\n\t */\n\t@Authorized( { PrivilegeConstants.GET_ALLERGIES })\n\tpublic Allergy getAllergy(Integer allergyListId) throws APIException;\n\t\n\t/**\n\t * Returns the Allergy identified by uuid\n\t * \n\t * @since 2.0\n\t * @param uuid identifies allergy \n\t * @return the allergy matching the given uuid",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 34,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 749,
    "end_line": 778,
    "snippet": "\tpublic Allergy getAllergy(Integer allergyListId) throws APIException;\n\t\n\t/**\n\t * Returns the Allergy identified by uuid\n\t * \n\t * @since 2.0\n\t * @param uuid identifies allergy \n\t * @return the allergy matching the given uuid\n\t * <strong>Should</strong> return allergy given valid uuid\n\t * <strong>Should</strong> return null if no object found with given uuid\n\t * @throws APIException\n\t */\n\t@Authorized( { PrivilegeConstants.GET_ALLERGIES })\n\tpublic Allergy getAllergyByUuid(String uuid) throws APIException;\n\t\n\t/**\n\t * Creates an AllergyListItem to the Patient's Allergy Active List. Sets the start date to now,\n\t * if it is null.\n\t * \n\t * @param allergy the Allergy\n\t * @throws APIException\n\t * <strong>Should</strong> save the allergy\n\t */\n\t@Authorized( { PrivilegeConstants.ADD_ALLERGIES, PrivilegeConstants.EDIT_ALLERGIES })\n\tpublic void saveAllergy(Allergy allergy) throws APIException;\n\t\n\t/**\n\t * Resolving the allergy, effectively removes the Allergy from the Patient's Active List by\n\t * setting the stop date to now, if null.\n\t * ",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 35,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 771,
    "end_line": 800,
    "snippet": "\t */\n\t@Authorized( { PrivilegeConstants.ADD_ALLERGIES, PrivilegeConstants.EDIT_ALLERGIES })\n\tpublic void saveAllergy(Allergy allergy) throws APIException;\n\t\n\t/**\n\t * Resolving the allergy, effectively removes the Allergy from the Patient's Active List by\n\t * setting the stop date to now, if null.\n\t * \n\t * @param allergy the Allergy\n\t * @param reason the reason of remove\n\t * @throws APIException\n\t * <strong>Should</strong> set the end date for the allergy\n\t */\n\t@Authorized( { PrivilegeConstants.EDIT_ALLERGIES })\n\tpublic void removeAllergy(Allergy allergy, String reason) throws APIException;\n\t\n\t/**\n\t * Used only in cases where the Allergy was entered by error\n\t * \n\t * @param allergy\n\t * @param reason\n\t * @throws APIException\n\t */\n\t@Authorized( { PrivilegeConstants.DELETE_ALLERGIES })\n\tpublic void voidAllergy(Allergy allergy, String reason) throws APIException;\n\t\n\t/**\n\t * Return the number of unvoided patients with names or patient identifiers or searchable person\n\t * attributes starting with or equal to the specified text\n\t * ",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 36,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 793,
    "end_line": 822,
    "snippet": "\t */\n\t@Authorized( { PrivilegeConstants.DELETE_ALLERGIES })\n\tpublic void voidAllergy(Allergy allergy, String reason) throws APIException;\n\t\n\t/**\n\t * Return the number of unvoided patients with names or patient identifiers or searchable person\n\t * attributes starting with or equal to the specified text\n\t * \n\t * @param query the string to search on\n\t * @return the number of patients matching the given search phrase\n\t * @since 1.8\n\t * <strong>Should</strong> return the right count when a patient has multiple matching person names\n\t * <strong>Should</strong> return the right count of patients with a matching identifier with no digits\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Integer getCountOfPatients(String query);\n\t\n\t/**\n\t * @param query the string to search on\n\t * @param includeVoided true/false whether or not to included voided patients\n\t * @return the number of patients matching the given search phrase\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Integer getCountOfPatients(String query, boolean includeVoided);\n\t\n\t/**\n\t * Get a limited size of patients from a given start index based on given criteria The\n\t * identifier is matched with the regex <code>OpenmrsConstants.PATIENT_IDENTIFIER_REGEX</code>\n\t * All parameters are optional and nullable. If null, it is not included in the search. Will not\n\t * return voided patients",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 37,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 815,
    "end_line": 844,
    "snippet": "\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic Integer getCountOfPatients(String query, boolean includeVoided);\n\t\n\t/**\n\t * Get a limited size of patients from a given start index based on given criteria The\n\t * identifier is matched with the regex <code>OpenmrsConstants.PATIENT_IDENTIFIER_REGEX</code>\n\t * All parameters are optional and nullable. If null, it is not included in the search. Will not\n\t * return voided patients\n\t * \n\t * @param name (optional) this is a slight break from the norm, patients with a partial match on\n\t *            this name will be returned\n\t * @param identifier (optional) only patients with a matching identifier are returned\n\t * @param identifierTypes (optional) the PatientIdentifierTypes to restrict to\n\t * @param matchIdentifierExactly (required) if true, then the given <code>identifier</code> must\n\t *            equal the id in the database. if false, then the identifier is 'searched' for by\n\t *            using a regular expression\n\t * @param start the starting index\n\t * @param length the number of patients to return\n\t * @return patients that matched the given criteria (and are not voided)\n\t * @throws APIException\n\t * @since 1.8\n\t */\n\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly, Integer start, Integer length) throws APIException;\n\t\n\t/**\n\t * Check if patient identifier types are locked, and if they are, throws an exception during\n\t * manipulation of a patient identifier type\n\t * ",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 38,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/PatientService.java",
    "start_line": 837,
    "end_line": 857,
    "snippet": "\t@Authorized( { PrivilegeConstants.GET_PATIENTS })\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly, Integer start, Integer length) throws APIException;\n\t\n\t/**\n\t * Check if patient identifier types are locked, and if they are, throws an exception during\n\t * manipulation of a patient identifier type\n\t * \n\t * @throws PatientIdentifierTypeLockedException\n\t */\n\tpublic void checkIfPatientIdentifierTypesAreLocked() throws PatientIdentifierTypeLockedException;\n\n\t/**\n\t * Get all patientIdentifiers that are associated to the patient program\n\t * @param patientProgram the patientProgram to be used to fetch the associated identifiers\n\t * @return PatientIdentifiers matching the patient program\n\t * @since 2.6.0\n\t */\n\t@Authorized({PrivilegeConstants.GET_PATIENT_IDENTIFIERS})\n\tpublic List<PatientIdentifier> getPatientIdentifiersByPatientProgram(PatientProgram patientProgram);\n}",
    "risk_level": "HIGH",
    "risk_score": 42,
    "deps": {
      "direct": 22,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "lab",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 109,
      "validate": 3,
      "transactional": 0,
      "null_checks": 2
    }
  },
  {
    "id": 39,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1,
    "end_line": 30,
    "snippet": "/**\n * This Source Code Form is subject to the terms of the Mozilla Public License,\n * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n *\n * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n * graphic logo is a trademark of OpenMRS Inc.\n */\npackage org.openmrs.api.impl;\n\n\nimport java.util.Arrays;\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.Collections;\nimport java.util.Date;\nimport java.util.HashSet;\nimport java.util.LinkedHashMap;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\nimport java.util.UUID;\nimport java.util.stream.Collectors;\n\nimport org.apache.commons.lang3.StringUtils;\nimport org.openmrs.Allergen;\nimport org.openmrs.Allergies;\nimport org.openmrs.Allergy;\nimport org.openmrs.BaseOpenmrsMetadata;",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 40,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 23,
    "end_line": 52,
    "snippet": "import java.util.UUID;\nimport java.util.stream.Collectors;\n\nimport org.apache.commons.lang3.StringUtils;\nimport org.openmrs.Allergen;\nimport org.openmrs.Allergies;\nimport org.openmrs.Allergy;\nimport org.openmrs.BaseOpenmrsMetadata;\nimport org.openmrs.Concept;\nimport org.openmrs.Encounter;\nimport org.openmrs.Location;\nimport org.openmrs.Obs;\nimport org.openmrs.Order;\nimport org.openmrs.Patient;\nimport org.openmrs.PatientIdentifier;\nimport org.openmrs.PatientIdentifierType;\nimport org.openmrs.PatientProgram;\nimport org.openmrs.Person;\nimport org.openmrs.PersonAddress;\nimport org.openmrs.PersonAttribute;\nimport org.openmrs.PersonName;\nimport org.openmrs.Relationship;\nimport org.openmrs.User;\nimport org.openmrs.Visit;\nimport org.openmrs.api.APIException;\nimport org.openmrs.api.BlankIdentifierException;\nimport org.openmrs.api.DuplicateIdentifierException;\nimport org.openmrs.api.EncounterService;\nimport org.openmrs.api.InsufficientIdentifiersException;\nimport org.openmrs.api.MissingRequiredIdentifierException;",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 41,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 45,
    "end_line": 74,
    "snippet": "import org.openmrs.User;\nimport org.openmrs.Visit;\nimport org.openmrs.api.APIException;\nimport org.openmrs.api.BlankIdentifierException;\nimport org.openmrs.api.DuplicateIdentifierException;\nimport org.openmrs.api.EncounterService;\nimport org.openmrs.api.InsufficientIdentifiersException;\nimport org.openmrs.api.MissingRequiredIdentifierException;\nimport org.openmrs.api.ObsService;\nimport org.openmrs.api.PatientIdentifierException;\nimport org.openmrs.api.PatientIdentifierTypeLockedException;\nimport org.openmrs.api.PatientService;\nimport org.openmrs.api.PersonService;\nimport org.openmrs.api.ProgramWorkflowService;\nimport org.openmrs.api.RefByUuid;\nimport org.openmrs.api.UserService;\nimport org.openmrs.api.VisitService;\nimport org.openmrs.api.context.Context;\nimport org.openmrs.api.db.PatientDAO;\nimport org.openmrs.api.db.hibernate.HibernateUtil;\nimport org.openmrs.parameter.EncounterSearchCriteria;\nimport org.openmrs.parameter.EncounterSearchCriteriaBuilder;\nimport org.openmrs.patient.IdentifierValidator;\nimport org.openmrs.patient.impl.LuhnIdentifierValidator;\nimport org.openmrs.person.PersonMergeLog;\nimport org.openmrs.person.PersonMergeLogData;\nimport org.openmrs.serialization.SerializationException;\nimport org.openmrs.util.OpenmrsConstants;\nimport org.openmrs.util.OpenmrsUtil;\nimport org.openmrs.util.PrivilegeConstants;",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 42,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 67,
    "end_line": 96,
    "snippet": "import org.openmrs.patient.IdentifierValidator;\nimport org.openmrs.patient.impl.LuhnIdentifierValidator;\nimport org.openmrs.person.PersonMergeLog;\nimport org.openmrs.person.PersonMergeLogData;\nimport org.openmrs.serialization.SerializationException;\nimport org.openmrs.util.OpenmrsConstants;\nimport org.openmrs.util.OpenmrsUtil;\nimport org.openmrs.util.PrivilegeConstants;\nimport org.openmrs.validator.PatientIdentifierValidator;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.beans.factory.annotation.Qualifier;\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\n/**\n * Default implementation of the patient service. This class should not be used on its own. The\n * current OpenMRS implementation should be fetched from the Context via\n * <code>Context.getPatientService()</code>\n * \n * @see org.openmrs.api.context.Context\n * @see org.openmrs.api.PatientService\n * @see org.openmrs.api.PersonService\n */\n@Service(\"patientService\")\n@Transactional\npublic class PatientServiceImpl extends BaseOpenmrsService implements PatientService, RefByUuid {\n\t\n\tprivate static final Logger log = LoggerFactory.getLogger(PatientServiceImpl.class);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 43,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 89,
    "end_line": 118,
    "snippet": " * @see org.openmrs.api.PatientService\n * @see org.openmrs.api.PersonService\n */\n@Service(\"patientService\")\n@Transactional\npublic class PatientServiceImpl extends BaseOpenmrsService implements PatientService, RefByUuid {\n\t\n\tprivate static final Logger log = LoggerFactory.getLogger(PatientServiceImpl.class);\n\t\n\t@Autowired\n\tprivate PatientDAO dao;\n\t\n\t/**\n\t * PatientIdentifierValidators registered through spring's applicationContext-service.xml\n\t */\n\t@Autowired\n\t@Qualifier(\"identifierValidators\")\n\tprivate Map<Class<? extends IdentifierValidator>, IdentifierValidator> identifierValidators;\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#setPatientDAO(org.openmrs.api.db.PatientDAO)\n\t */\n\t@Override\n\tpublic void setPatientDAO(PatientDAO dao) {\n\t\tthis.dao = dao;\n\t}\n\t\n\t/**\n\t * Clean up after this class. Set the static var to null so that the classloader can reclaim the\n\t * space.",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 44,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 111,
    "end_line": 140,
    "snippet": "\t@Override\n\tpublic void setPatientDAO(PatientDAO dao) {\n\t\tthis.dao = dao;\n\t}\n\t\n\t/**\n\t * Clean up after this class. Set the static var to null so that the classloader can reclaim the\n\t * space.\n\t * \n\t * @see org.openmrs.api.impl.BaseOpenmrsService#onShutdown()\n\t */\n\t@Override\n\tpublic void onShutdown() {\n\t\tsetIdentifierValidators(null);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#savePatient(org.openmrs.Patient)\n\t */\n\t@Override\n\tpublic Patient savePatient(Patient patient) throws APIException {\n\t\trequireAppropriatePatientModificationPrivilege(patient);\n\n\t\tif (!patient.getVoided() && patient.getIdentifiers().size() == 1) {\n\t\t\tpatient.getPatientIdentifier().setPreferred(true);\n\t\t}\n\n\t\tif (!patient.getVoided()) {\n\t\t\tcheckPatientIdentifiers(patient);\n\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 45,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 133,
    "end_line": 162,
    "snippet": "\n\t\tif (!patient.getVoided() && patient.getIdentifiers().size() == 1) {\n\t\t\tpatient.getPatientIdentifier().setPreferred(true);\n\t\t}\n\n\t\tif (!patient.getVoided()) {\n\t\t\tcheckPatientIdentifiers(patient);\n\t\t}\n\n\t\tsetPreferredPatientIdentifier(patient);\n\t\tsetPreferredPatientName(patient);\n\t\tsetPreferredPatientAddress(patient);\n\n\t\treturn dao.savePatient(patient);\n\t}\n\n\tprivate void requireAppropriatePatientModificationPrivilege(Patient patient) {\n\t\tif (patient.getPatientId() == null) {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.ADD_PATIENTS);\n\t\t} else {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.EDIT_PATIENTS);\n\t\t}\n\t\tif (patient.getVoided()) {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.DELETE_PATIENTS);\n\t\t}\n\t}\n\n\tprivate void setPreferredPatientIdentifier(Patient patient) {\n\t\tPatientIdentifier preferredIdentifier = null;\n\t\tPatientIdentifier possiblePreferredId = patient.getPatientIdentifier();",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 46,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 155,
    "end_line": 184,
    "snippet": "\t\tif (patient.getVoided()) {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.DELETE_PATIENTS);\n\t\t}\n\t}\n\n\tprivate void setPreferredPatientIdentifier(Patient patient) {\n\t\tPatientIdentifier preferredIdentifier = null;\n\t\tPatientIdentifier possiblePreferredId = patient.getPatientIdentifier();\n\t\tif (possiblePreferredId != null && possiblePreferredId.getPreferred() && !possiblePreferredId.getVoided()) {\n\t\t\tpreferredIdentifier = possiblePreferredId;\n\t\t}\n\n\t\tfor (PatientIdentifier id : patient.getIdentifiers()) {\n\t\t\tif (preferredIdentifier == null && !id.getVoided()) {\n\t\t\t\tid.setPreferred(true);\n\t\t\t\tpreferredIdentifier = id;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!id.equals(preferredIdentifier)) {\n\t\t\t\tid.setPreferred(false);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate void setPreferredPatientName(Patient patient) {\n\t\tPersonName preferredName = null;\n\t\tPersonName possiblePreferredName = patient.getPersonName();\n\t\tif (possiblePreferredName != null && possiblePreferredName.getPreferred() && !possiblePreferredName.getVoided()) {\n\t\t\tpreferredName = possiblePreferredName;",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 47,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 177,
    "end_line": 206,
    "snippet": "\t\t}\n\t}\n\n\tprivate void setPreferredPatientName(Patient patient) {\n\t\tPersonName preferredName = null;\n\t\tPersonName possiblePreferredName = patient.getPersonName();\n\t\tif (possiblePreferredName != null && possiblePreferredName.getPreferred() && !possiblePreferredName.getVoided()) {\n\t\t\tpreferredName = possiblePreferredName;\n\t\t}\n\n\t\tfor (PersonName name : patient.getNames()) {\n\t\t\tif (preferredName == null && !name.getVoided()) {\n\t\t\t\tname.setPreferred(true);\n\t\t\t\tpreferredName = name;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!name.equals(preferredName)) {\n\t\t\t\tname.setPreferred(false);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void setPreferredPatientAddress(Patient patient) {\n\t\tPersonAddress preferredAddress = null;\n\t\tPersonAddress possiblePreferredAddress = patient.getPersonAddress();\n\t\tif (possiblePreferredAddress != null && possiblePreferredAddress.getPreferred()\n\t\t\t\t&& !possiblePreferredAddress.getVoided()) {\n\t\t\tpreferredAddress = possiblePreferredAddress;\n\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 48,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 199,
    "end_line": 228,
    "snippet": "\t\n\tprivate void setPreferredPatientAddress(Patient patient) {\n\t\tPersonAddress preferredAddress = null;\n\t\tPersonAddress possiblePreferredAddress = patient.getPersonAddress();\n\t\tif (possiblePreferredAddress != null && possiblePreferredAddress.getPreferred()\n\t\t\t\t&& !possiblePreferredAddress.getVoided()) {\n\t\t\tpreferredAddress = possiblePreferredAddress;\n\t\t}\n\n\t\tfor (PersonAddress address : patient.getAddresses()) {\n\t\t\tif (preferredAddress == null && !address.getVoided()) {\n\t\t\t\taddress.setPreferred(true);\n\t\t\t\tpreferredAddress = address;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!address.equals(preferredAddress)) {\n\t\t\t\taddress.setPreferred(false);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatient(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Patient getPatient(Integer patientId) throws APIException {\n\t\treturn dao.getPatient(patientId);\n\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 49,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 221,
    "end_line": 250,
    "snippet": "\t/**\n\t * @see org.openmrs.api.PatientService#getPatient(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Patient getPatient(Integer patientId) throws APIException {\n\t\treturn dao.getPatient(patientId);\n\t}\n\t\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Patient getPatientOrPromotePerson(Integer patientOrPersonId) {\n\t\tPerson person = Context.getPersonService().getPerson(patientOrPersonId);\n\t\tif (person == null) {\n\t\t\treturn null;\n\t\t}\n\t\tperson = HibernateUtil.getRealObjectFromProxy(person);\n\t\tif (person instanceof Patient) {\n\t\t\treturn (Patient)person;\n\t\t}\n\t\telse {\n\t\t\treturn new Patient(person);\n\t\t}\n\t}\n\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatients()\n\t */\n\t@Override\n\t@Transactional(readOnly = true)",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 50,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 243,
    "end_line": 272,
    "snippet": "\t\t}\n\t}\n\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatients()\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getAllPatients() throws APIException {\n\t\treturn Context.getPatientService().getAllPatients(false);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatients(boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getAllPatients(boolean includeVoided) throws APIException {\n\t\treturn dao.getAllPatients(includeVoided);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatients(java.lang.String, java.lang.String,\n\t *      java.util.List, boolean)\n\t */\n\t@Override\n\t// TODO - search for usage with non-empty list of patient identifier types\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly) throws APIException {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 51,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 265,
    "end_line": 294,
    "snippet": "\t * @see org.openmrs.api.PatientService#getPatients(java.lang.String, java.lang.String,\n\t *      java.util.List, boolean)\n\t */\n\t@Override\n\t// TODO - search for usage with non-empty list of patient identifier types\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly) throws APIException {\n\t\t\n\t\treturn Context.getPatientService().getPatients(name, identifier, identifierTypes, matchIdentifierExactly, 0, null);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#checkPatientIdentifiers(org.openmrs.Patient)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic void checkPatientIdentifiers(Patient patient) throws PatientIdentifierException {\n\t\t// check patient has at least one identifier\n\t\tif (!patient.getVoided() && patient.getActiveIdentifiers().isEmpty()) {\n\t\t\tthrow new InsufficientIdentifiersException(\"At least one nonvoided Patient Identifier is required\");\n\t\t}\n\n\t\tfinal List<PatientIdentifier> patientIdentifiers = new ArrayList<>(patient.getIdentifiers());\n\n\t\tfinal Set<String> uniqueIdentifiers = new HashSet<>();\n\n\t\tpatientIdentifiers.stream()\n\t\t\t.filter(pi -> !pi.getVoided())\n\t\t\t.forEach(pi -> {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 52,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 287,
    "end_line": 316,
    "snippet": "\n\t\tfinal List<PatientIdentifier> patientIdentifiers = new ArrayList<>(patient.getIdentifiers());\n\n\t\tfinal Set<String> uniqueIdentifiers = new HashSet<>();\n\n\t\tpatientIdentifiers.stream()\n\t\t\t.filter(pi -> !pi.getVoided())\n\t\t\t.forEach(pi -> {\n\t\t\t\ttry {\n\t\t\t\t\tPatientIdentifierValidator.validateIdentifier(pi);\n\t\t\t\t}\n\t\t\t\tcatch (BlankIdentifierException bie) {\n\t\t\t\t\tpatient.removeIdentifier(pi);\n\t\t\t\t\tthrow bie;\n\t\t\t\t}\n\n\t\t\t\t// check this patient for duplicate identifiers+identifierType\n\t\t\t\tString compareString = pi.getIdentifier() + \" id type #: \" + pi.getIdentifierType().getPatientIdentifierTypeId();\n\t\t\t\tif(! uniqueIdentifiers.add(compareString)) {\n\t\t\t\t\tthrow new DuplicateIdentifierException(\"This patient has two identical identifiers of type \"\n\t\t\t\t\t\t\t+ compareString, pi);\n\t\t\t\t}\n\t\t\t});\n\n\t\tcheckForMissingRequiredIdentifiers(patientIdentifiers);\n\n\t}\n\n\tprivate void checkForMissingRequiredIdentifiers(List<PatientIdentifier> patientIdentifiers) {\n\t\tfinal Set<PatientIdentifierType> patientIdentifierTypes =",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 53,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 309,
    "end_line": 338,
    "snippet": "\t\t\t});\n\n\t\tcheckForMissingRequiredIdentifiers(patientIdentifiers);\n\n\t}\n\n\tprivate void checkForMissingRequiredIdentifiers(List<PatientIdentifier> patientIdentifiers) {\n\t\tfinal Set<PatientIdentifierType> patientIdentifierTypes =\n\t\t\t\tpatientIdentifiers.stream()\n\t\t\t\t\t\t.map(PatientIdentifier::getIdentifierType)\n\t\t\t\t\t\t.collect(Collectors.toSet());\n\n\t\tfinal List<PatientIdentifierType> requiredTypes = this.getPatientIdentifierTypes(null, null, true, null);\n\t\tfinal Set<String> missingRequiredTypeNames =\n\t\t\t\trequiredTypes.stream()\n\t\t\t\t\t\t.filter(requiredType -> !patientIdentifierTypes.contains(requiredType))\n\t\t\t\t\t\t.map(BaseOpenmrsMetadata::getName)\n\t\t\t\t\t\t.collect(Collectors.toSet());\n\n\t\tif(! missingRequiredTypeNames.isEmpty()) {\n\t\t\tthrow new MissingRequiredIdentifierException(\n\t\t\t\t\t\"Patient is missing the following required identifier(s): \" + String.join(\", \", missingRequiredTypeNames));\n\t\t}\n\t}\n\n\t/**\n\t * @see org.openmrs.api.PatientService#voidPatient(org.openmrs.Patient, java.lang.String)\n\t */\n\t@Override\n\tpublic Patient voidPatient(Patient patient, String reason) throws APIException {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 54,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 331,
    "end_line": 360,
    "snippet": "\t\t}\n\t}\n\n\t/**\n\t * @see org.openmrs.api.PatientService#voidPatient(org.openmrs.Patient, java.lang.String)\n\t */\n\t@Override\n\tpublic Patient voidPatient(Patient patient, String reason) throws APIException {\n\t\tif (patient == null) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// patient and patientidentifier attributes taken care of by the BaseVoidHandler\n\t\t//call the DAO layer directly to avoid any further AOP around save*\n\t\treturn dao.savePatient(patient);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#unvoidPatient(org.openmrs.Patient)\n\t */\n\t@Override\n\tpublic Patient unvoidPatient(Patient patient) throws APIException {\n\t\tif (patient == null) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// patient and patientidentifier attributes taken care of by the BaseUnvoidHandler\n\t\t\n\t\treturn Context.getPatientService().savePatient(patient);\n\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 55,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 353,
    "end_line": 382,
    "snippet": "\t\tif (patient == null) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\t// patient and patientidentifier attributes taken care of by the BaseUnvoidHandler\n\t\t\n\t\treturn Context.getPatientService().savePatient(patient);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#purgePatient(org.openmrs.Patient)\n\t */\n\t@Override\n\tpublic void purgePatient(Patient patient) throws APIException {\n\t\tdao.deletePatient(patient);\n\t}\n\t\n\t// patient identifier section\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifiers(java.lang.String, java.util.List,\n\t *      java.util.List, java.util.List, java.lang.Boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifier> getPatientIdentifiers(String identifier,\n\t        List<PatientIdentifierType> patientIdentifierTypes, List<Location> locations, List<Patient> patients,\n\t        Boolean isPreferred) throws APIException {\n\t\t\n\t\tif (patientIdentifierTypes == null) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 56,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 375,
    "end_line": 404,
    "snippet": "\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifier> getPatientIdentifiers(String identifier,\n\t        List<PatientIdentifierType> patientIdentifierTypes, List<Location> locations, List<Patient> patients,\n\t        Boolean isPreferred) throws APIException {\n\t\t\n\t\tif (patientIdentifierTypes == null) {\n\t\t\tpatientIdentifierTypes = new ArrayList<>();\n\t\t}\n\t\t\n\t\tif (locations == null) {\n\t\t\tlocations = new ArrayList<>();\n\t\t}\n\t\t\n\t\tif (patients == null) {\n\t\t\tpatients = new ArrayList<>();\n\t\t}\n\t\t\n\t\treturn dao.getPatientIdentifiers(identifier, patientIdentifierTypes, locations, patients, isPreferred);\n\t}\n\t// end patient identifier section\n\t\n\t// patient identifier _type_ section\n\t\n\t/**\n\t * \n\t * @see org.openmrs.api.PatientService#savePatientIdentifierType(org.openmrs.PatientIdentifierType)\n\t */\n\t@Override",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 57,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 397,
    "end_line": 426,
    "snippet": "\t\n\t// patient identifier _type_ section\n\t\n\t/**\n\t * \n\t * @see org.openmrs.api.PatientService#savePatientIdentifierType(org.openmrs.PatientIdentifierType)\n\t */\n\t@Override\n\tpublic PatientIdentifierType savePatientIdentifierType(PatientIdentifierType patientIdentifierType) throws APIException {\n\t\tcheckIfPatientIdentifierTypesAreLocked();\n\t\treturn dao.savePatientIdentifierType(patientIdentifierType);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatientIdentifierTypes()\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes() throws APIException {\n\t\treturn Context.getPatientService().getAllPatientIdentifierTypes(false);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatientIdentifierTypes(boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes(boolean includeRetired) throws APIException {\n\t\treturn dao.getAllPatientIdentifierTypes(includeRetired);\n\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 58,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 419,
    "end_line": 448,
    "snippet": "\t/**\n\t * @see org.openmrs.api.PatientService#getAllPatientIdentifierTypes(boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifierType> getAllPatientIdentifierTypes(boolean includeRetired) throws APIException {\n\t\treturn dao.getAllPatientIdentifierTypes(includeRetired);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierTypes(java.lang.String,\n\t *      java.lang.String, java.lang.Boolean, java.lang.Boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<PatientIdentifierType> getPatientIdentifierTypes(String name, String format, Boolean required,\n\t        Boolean hasCheckDigit) throws APIException {\n\t\tList<PatientIdentifierType> patientIdentifierTypes = dao.getPatientIdentifierTypes(name, format, required, hasCheckDigit);\n\t\tif (patientIdentifierTypes == null) {\n\t\t\treturn new ArrayList<>();\n\t\t}\n\t\treturn patientIdentifierTypes;\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierType(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifierType getPatientIdentifierType(Integer patientIdentifierTypeId) throws APIException {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 59,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 441,
    "end_line": 470,
    "snippet": "\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierType(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifierType getPatientIdentifierType(Integer patientIdentifierTypeId) throws APIException {\n\t\treturn dao.getPatientIdentifierType(patientIdentifierTypeId);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierTypeByName(java.lang.String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifierType getPatientIdentifierTypeByName(String name) throws APIException {\n\t\tList<PatientIdentifierType> types = getPatientIdentifierTypes(name, null, null, null);\n\t\t\n\t\tif (!types.isEmpty()) {\n\t\t\treturn types.get(0);\n\t\t}\n\t\t\n\t\treturn null;\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#retirePatientIdentifierType(org.openmrs.PatientIdentifierType,\n\t *      String)\n\t */",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 60,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 463,
    "end_line": 492,
    "snippet": "\t\t\n\t\treturn null;\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#retirePatientIdentifierType(org.openmrs.PatientIdentifierType,\n\t *      String)\n\t */\n\t@Override\n\tpublic PatientIdentifierType retirePatientIdentifierType(PatientIdentifierType patientIdentifierType, String reason)\n\t        throws APIException {\n\t\tcheckIfPatientIdentifierTypesAreLocked();\n\t\tif (reason == null || reason.length() < 1) {\n\t\t\tthrow new APIException(\"Patient.identifier.retire.reason\", (Object[]) null);\n\t\t}\n\t\t\n\t\tpatientIdentifierType.setRetired(true);\n\t\tpatientIdentifierType.setRetiredBy(Context.getAuthenticatedUser());\n\t\tpatientIdentifierType.setDateRetired(new Date());\n\t\tpatientIdentifierType.setRetireReason(reason);\n\t\treturn Context.getPatientService().savePatientIdentifierType(patientIdentifierType);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#unretirePatientIdentifierType(org.openmrs.PatientIdentifierType)\n\t */\n\t@Override\n\tpublic PatientIdentifierType unretirePatientIdentifierType(PatientIdentifierType patientIdentifierType)\n\t        throws APIException {\n\t\tcheckIfPatientIdentifierTypesAreLocked();",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 61,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 485,
    "end_line": 514,
    "snippet": "\t\n\t/**\n\t * @see org.openmrs.api.PatientService#unretirePatientIdentifierType(org.openmrs.PatientIdentifierType)\n\t */\n\t@Override\n\tpublic PatientIdentifierType unretirePatientIdentifierType(PatientIdentifierType patientIdentifierType)\n\t        throws APIException {\n\t\tcheckIfPatientIdentifierTypesAreLocked();\n\t\tpatientIdentifierType.setRetired(false);\n\t\tpatientIdentifierType.setRetiredBy(null);\n\t\tpatientIdentifierType.setDateRetired(null);\n\t\tpatientIdentifierType.setRetireReason(null);\n\t\treturn Context.getPatientService().savePatientIdentifierType(patientIdentifierType);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#purgePatientIdentifierType(org.openmrs.PatientIdentifierType)\n\t */\n\t@Override\n\tpublic void purgePatientIdentifierType(PatientIdentifierType patientIdentifierType) throws APIException {\n\t\tcheckIfPatientIdentifierTypesAreLocked();\n\t\tdao.deletePatientIdentifierType(patientIdentifierType);\n\t}\n\t\n\t// end patient identifier _type_ section\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatients(java.lang.String)\n\t */\n\t@Override",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 62,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 507,
    "end_line": 536,
    "snippet": "\t}\n\t\n\t// end patient identifier _type_ section\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatients(java.lang.String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String query) throws APIException {\n\t\treturn Context.getPatientService().getPatients(query, 0, null);\n\t}\n\t\n\t/**\n\t * This default implementation simply looks at the OpenMRS internal id (patient_id). If the id\n\t * is null, assume this patient isn't found. If the patient_id is not null, try and find that id\n\t * in the database\n\t * \n\t * @see org.openmrs.api.PatientService#getPatientByExample(org.openmrs.Patient)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Patient getPatientByExample(Patient patientToMatch) throws APIException {\n\t\tif (patientToMatch == null || patientToMatch.getPatientId() == null) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn Context.getPatientService().getPatient(patientToMatch.getPatientId());\n\t}\n\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 63,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 529,
    "end_line": 558,
    "snippet": "\tpublic Patient getPatientByExample(Patient patientToMatch) throws APIException {\n\t\tif (patientToMatch == null || patientToMatch.getPatientId() == null) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\treturn Context.getPatientService().getPatient(patientToMatch.getPatientId());\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getDuplicatePatientsByAttributes(java.util.List)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getDuplicatePatientsByAttributes(List<String> attributes) throws APIException {\n\t\t\n\t\tif (attributes == null || attributes.isEmpty()) {\n\t\t\tthrow new APIException(\"Patient.no.attribute\", (Object[]) null);\n\t\t}\n\t\t\n\t\treturn dao.getDuplicatePatientsByAttributes(attributes);\n\t}\n\t\n\t/**\n\t * generate a relationship hash for use in mergePatients; follows the convention:\n\t * [relationshipType][A|B][relativeId]\n\t * \n\t * @param rel relationship under consideration\n\t * @param primary the focus of the hash\n\t * @return hash depicting relevant information to avoid duplicates\n\t */",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 64,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 551,
    "end_line": 580,
    "snippet": "\t/**\n\t * generate a relationship hash for use in mergePatients; follows the convention:\n\t * [relationshipType][A|B][relativeId]\n\t * \n\t * @param rel relationship under consideration\n\t * @param primary the focus of the hash\n\t * @return hash depicting relevant information to avoid duplicates\n\t */\n\tprivate String relationshipHash(Relationship rel, Person primary) {\n\t\tboolean isA = rel.getPersonA().equals(primary);\n\t\treturn rel.getRelationshipType().getRelationshipTypeId().toString() + (isA ? \"A\" : \"B\")\n\t\t        + (isA ? rel.getPersonB().getPersonId().toString() : rel.getPersonA().getPersonId().toString());\n\t}\n\n\t/**\n\t * 1) Moves object (encounters/obs) pointing to <code>nonPreferred</code> to\n\t * <code>preferred</code> 2) Copies data (gender/birthdate/names/ids/etc) from\n\t * <code>nonPreferred</code> to <code>preferred</code> iff the data is missing or null in\n\t * <code>preferred</code> 3) <code>notPreferred</code> is marked as voided\n\t * \n\t * @param preferred\n\t * @param notPreferred\n\t * @throws APIException\n\t * @see org.openmrs.api.PatientService#mergePatients(org.openmrs.Patient, org.openmrs.Patient)\n\t */\n\t@Override\n\tpublic void mergePatients(Patient preferred, Patient notPreferred) throws APIException, SerializationException {\n\t\tlog.debug(\"Merging patients: (preferred)\" + preferred.getPatientId() + \", (notPreferred) \"\n\t\t        + notPreferred.getPatientId());\n\t\tif (preferred.getPatientId().equals(notPreferred.getPatientId())) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 65,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 573,
    "end_line": 602,
    "snippet": "\t * @throws APIException\n\t * @see org.openmrs.api.PatientService#mergePatients(org.openmrs.Patient, org.openmrs.Patient)\n\t */\n\t@Override\n\tpublic void mergePatients(Patient preferred, Patient notPreferred) throws APIException, SerializationException {\n\t\tlog.debug(\"Merging patients: (preferred)\" + preferred.getPatientId() + \", (notPreferred) \"\n\t\t        + notPreferred.getPatientId());\n\t\tif (preferred.getPatientId().equals(notPreferred.getPatientId())) {\n\t\t\tlog.debug(\"Merge operation cancelled: Cannot merge user\" + preferred.getPatientId() + \" to self\");\n\t\t\tthrow new APIException(\"Patient.merge.cancelled\", new Object[] { preferred.getPatientId() });\n\t\t}\n\t\trequireNoActiveOrderOfSameType(preferred,notPreferred);\n\t\tPersonMergeLogData mergedData = new PersonMergeLogData();\n\t\tmergeVisits(preferred, notPreferred, mergedData);\n\t\tmergeEncounters(preferred, notPreferred, mergedData);\n\t\tmergeProgramEnrolments(preferred, notPreferred, mergedData);\n\t\tmergeRelationships(preferred, notPreferred, mergedData);\n\t\tmergeObservationsNotContainedInEncounters(preferred, notPreferred, mergedData);\n\t\tmergeIdentifiers(preferred, notPreferred, mergedData);\n\t\t\n\t\tmergeNames(preferred, notPreferred, mergedData);\n\t\tmergeAddresses(preferred, notPreferred, mergedData);\n\t\tmergePersonAttributes(preferred, notPreferred, mergedData);\n\t\tmergeGenderInformation(preferred, notPreferred, mergedData);\n\t\tmergeDateOfBirth(preferred, notPreferred, mergedData);\n\t\tmergeDateOfDeath(preferred, notPreferred, mergedData);\n\t\t\n\t\t// void the non preferred patient\n\t\tContext.getPatientService().voidPatient(notPreferred, \"Merged with patient #\" + preferred.getPatientId());\n\t\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 66,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 595,
    "end_line": 624,
    "snippet": "\t\tmergePersonAttributes(preferred, notPreferred, mergedData);\n\t\tmergeGenderInformation(preferred, notPreferred, mergedData);\n\t\tmergeDateOfBirth(preferred, notPreferred, mergedData);\n\t\tmergeDateOfDeath(preferred, notPreferred, mergedData);\n\t\t\n\t\t// void the non preferred patient\n\t\tContext.getPatientService().voidPatient(notPreferred, \"Merged with patient #\" + preferred.getPatientId());\n\t\t\n\t\t// void the person associated with not preferred patient\n\t\tContext.getPersonService().voidPerson(notPreferred,\n\t\t    \"The patient corresponding to this person has been voided and Merged with patient #\" + preferred.getPatientId());\n\t\t\n\t\t// associate the Users associated with the not preferred person, to the preferred person.\n\t\tchangeUserAssociations(preferred, notPreferred, mergedData);\n\t\t\n\t\t// Save the newly update preferred patient\n\t\t// This must be called _after_ voiding the nonPreferred patient so that\n\t\t//  a \"Duplicate Identifier\" error doesn't pop up.\n\t\tsavePatient(preferred);\n\t\t\n\t\t//save the person merge log\n\t\tPersonMergeLog personMergeLog = new PersonMergeLog();\n\t\tpersonMergeLog.setWinner(preferred);\n\t\tpersonMergeLog.setLoser(notPreferred);\n\t\tpersonMergeLog.setPersonMergeLogData(mergedData);\n\t\tContext.getPersonService().savePersonMergeLog(personMergeLog);\n\t}\n\t\n\tprivate void requireNoActiveOrderOfSameType(Patient patient1, Patient patient2) {\n\t\tString messageKey = \"Patient.merge.cannotHaveSameTypeActiveOrders\";",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 67,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 617,
    "end_line": 646,
    "snippet": "\t\tpersonMergeLog.setWinner(preferred);\n\t\tpersonMergeLog.setLoser(notPreferred);\n\t\tpersonMergeLog.setPersonMergeLogData(mergedData);\n\t\tContext.getPersonService().savePersonMergeLog(personMergeLog);\n\t}\n\t\n\tprivate void requireNoActiveOrderOfSameType(Patient patient1, Patient patient2) {\n\t\tString messageKey = \"Patient.merge.cannotHaveSameTypeActiveOrders\";\n\t\tList<Order> ordersByPatient1 = Context.getOrderService().getAllOrdersByPatient(patient1);\n\t\tList<Order> ordersByPatient2 = Context.getOrderService().getAllOrdersByPatient(patient2);\n\t\tordersByPatient1.forEach((Order order1) -> ordersByPatient2.forEach((Order order2) -> {\n\t\t\tif (order1.isActive() && order2.isActive() && order1.getOrderType().equals(order2.getOrderType())) {\n\t\t\t\tObject[] parameters = { patient1.getPatientId(), patient2.getPatientId(), order1.getOrderType() };\n\t\t\t\tString message = Context.getMessageSourceService().getMessage(messageKey, parameters,\n\t\t\t\t\t\tContext.getLocale());\n\t\t\t\tlog.debug(message);\n\t\t\t\tthrow new APIException(message);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate void mergeProgramEnrolments(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// copy all program enrollments\n\t\tProgramWorkflowService programService = Context.getProgramWorkflowService();\n\t\tfor (PatientProgram pp : programService.getPatientPrograms(notPreferred, null, null, null, null, null, false)) {\n\t\t\tif (!pp.getVoided()) {\n\t\t\t\tpp.setPatient(preferred);\n\t\t\t\tlog.debug(\"Moving patientProgram {} to {}\", pp.getPatientProgramId(), preferred.getPatientId());\n\t\t\t\tPatientProgram persisted = programService.savePatientProgram(pp);\n\t\t\t\tmergedData.addMovedProgram(persisted.getUuid());",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 68,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 639,
    "end_line": 668,
    "snippet": "\t\t// copy all program enrollments\n\t\tProgramWorkflowService programService = Context.getProgramWorkflowService();\n\t\tfor (PatientProgram pp : programService.getPatientPrograms(notPreferred, null, null, null, null, null, false)) {\n\t\t\tif (!pp.getVoided()) {\n\t\t\t\tpp.setPatient(preferred);\n\t\t\t\tlog.debug(\"Moving patientProgram {} to {}\", pp.getPatientProgramId(), preferred.getPatientId());\n\t\t\t\tPatientProgram persisted = programService.savePatientProgram(pp);\n\t\t\t\tmergedData.addMovedProgram(persisted.getUuid());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void mergeVisits(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// move all visits, including voided ones (encounters will be handled below)\n\t\t//TODO: this should be a copy, not a move\n\t\t\n\t\tVisitService visitService = Context.getVisitService();\n\t\t\n\t\tfor (Visit visit : visitService.getVisitsByPatient(notPreferred, true, true)) {\n\t\t\tlog.debug(\"Merging visit {} to {}\", visit.getVisitId(), preferred.getPatientId());\n\t\t\tvisit.setPatient(preferred);\n\t\t\tVisit persisted = visitService.saveVisit(visit);\n\t\t\tmergedData.addMovedVisit(persisted.getUuid());\n\t\t}\n\t}\n\t\n\tprivate void mergeEncounters(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// change all encounters. This will cascade to obs and orders contained in those encounters\n\t\t// TODO: this should be a copy, not a move\n\t\tEncounterService es = Context.getEncounterService();",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 69,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 661,
    "end_line": 690,
    "snippet": "\t\t\tmergedData.addMovedVisit(persisted.getUuid());\n\t\t}\n\t}\n\t\n\tprivate void mergeEncounters(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// change all encounters. This will cascade to obs and orders contained in those encounters\n\t\t// TODO: this should be a copy, not a move\n\t\tEncounterService es = Context.getEncounterService();\n\n\t\tEncounterSearchCriteria notPreferredPatientEncounterSearchCriteria = new EncounterSearchCriteriaBuilder()\n\t\t\t\t.setIncludeVoided(true)\n\t\t\t\t.setPatient(notPreferred)\n\t\t\t\t.createEncounterSearchCriteria();\n\t\tfor (Encounter e : es.getEncounters(notPreferredPatientEncounterSearchCriteria)) {\n\t\t\te.setPatient(preferred);\n\t\t\tlog.debug(\"Merging encounter \" + e.getEncounterId() + \" to \" + preferred.getPatientId());\n\t\t\tEncounter persisted = es.saveEncounter(e);\n\t\t\tmergedData.addMovedEncounter(persisted.getUuid());\n\t\t}\n\t}\n\t\n\tprivate void mergeRelationships(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// copy all relationships\n\t\tPersonService personService = Context.getPersonService();\n\t\tSet<String> existingRelationships = new HashSet<>();\n\t\t// fill in the existing relationships with hashes\n\t\tfor (Relationship rel : personService.getRelationshipsByPerson(preferred)) {\n\t\t\texistingRelationships.add(relationshipHash(rel, preferred));\n\t\t}\n\t\t// iterate over notPreferred's relationships and only copy them if they are needed",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 70,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 683,
    "end_line": 712,
    "snippet": "\t\t// copy all relationships\n\t\tPersonService personService = Context.getPersonService();\n\t\tSet<String> existingRelationships = new HashSet<>();\n\t\t// fill in the existing relationships with hashes\n\t\tfor (Relationship rel : personService.getRelationshipsByPerson(preferred)) {\n\t\t\texistingRelationships.add(relationshipHash(rel, preferred));\n\t\t}\n\t\t// iterate over notPreferred's relationships and only copy them if they are needed\n\t\tfor (Relationship rel : personService.getRelationshipsByPerson(notPreferred)) {\n\t\t\tif (!rel.getVoided()) {\n\t\t\t\tboolean personAisPreferred = rel.getPersonA().equals(preferred);\n\t\t\t\tboolean personAisNotPreferred = rel.getPersonA().equals(notPreferred);\n\t\t\t\tboolean personBisPreferred = rel.getPersonB().equals(preferred);\n\t\t\t\tboolean personBisNotPreferred = rel.getPersonB().equals(notPreferred);\n\t\t\t\tString relHash = relationshipHash(rel, notPreferred);\n\t\t\t\t\n\t\t\t\tif ((personAisPreferred && personBisNotPreferred) || (personBisPreferred && personAisNotPreferred)) {\n\t\t\t\t\t// void this relationship if it's between the preferred and notPreferred patients\n\t\t\t\t\tpersonService.voidRelationship(rel, \"person \" + (personAisNotPreferred ? \"A\" : \"B\")\n\t\t\t\t\t        + \" was merged to person \" + (personAisPreferred ? \"A\" : \"B\"));\n\t\t\t\t} else if (existingRelationships.contains(relHash)) {\n\t\t\t\t\t// void this relationship if it already exists between preferred and the other side\n\t\t\t\t\tpersonService.voidRelationship(rel, \"person \" + (personAisNotPreferred ? \"A\" : \"B\")\n\t\t\t\t\t        + \" was merged and a relationship already exists\");\n\t\t\t\t} else {\n\t\t\t\t\t// copy this relationship and replace notPreferred with preferred\n\t\t\t\t\tRelationship tmpRel = rel.copy();\n\t\t\t\t\tif (personAisNotPreferred) {\n\t\t\t\t\t\ttmpRel.setPersonA(preferred);\n\t\t\t\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 71,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 705,
    "end_line": 734,
    "snippet": "\t\t\t\t\tpersonService.voidRelationship(rel, \"person \" + (personAisNotPreferred ? \"A\" : \"B\")\n\t\t\t\t\t        + \" was merged and a relationship already exists\");\n\t\t\t\t} else {\n\t\t\t\t\t// copy this relationship and replace notPreferred with preferred\n\t\t\t\t\tRelationship tmpRel = rel.copy();\n\t\t\t\t\tif (personAisNotPreferred) {\n\t\t\t\t\t\ttmpRel.setPersonA(preferred);\n\t\t\t\t\t}\n\t\t\t\t\tif (personBisNotPreferred) {\n\t\t\t\t\t\ttmpRel.setPersonB(preferred);\n\t\t\t\t\t}\n\t\t\t\t\tlog.debug(\"Copying relationship \" + rel.getRelationshipId() + \" to \" + preferred.getPatientId());\n\t\t\t\t\tRelationship persisted = personService.saveRelationship(tmpRel);\n\t\t\t\t\tmergedData.addCreatedRelationship(persisted.getUuid());\n\t\t\t\t\t// void the existing relationship to the notPreferred\n\t\t\t\t\tpersonService.voidRelationship(rel, \"person \" + (personAisNotPreferred ? \"A\" : \"B\")\n\t\t\t\t\t        + \" was merged, relationship copied to #\" + tmpRel.getRelationshipId());\n\t\t\t\t\t// add the relationship hash to existing relationships\n\t\t\t\t\texistingRelationships.add(relHash);\n\t\t\t\t}\n\t\t\t\tmergedData.addVoidedRelationship(rel.getUuid());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void mergeObservationsNotContainedInEncounters(Patient preferred, Patient notPreferred,\n\t        PersonMergeLogData mergedData) {\n\t\t// move all obs that weren't contained in encounters\n\t\t// TODO: this should be a copy, not a move\n\t\tObsService obsService = Context.getObsService();",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 72,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 727,
    "end_line": 756,
    "snippet": "\t\t}\n\t}\n\t\n\tprivate void mergeObservationsNotContainedInEncounters(Patient preferred, Patient notPreferred,\n\t        PersonMergeLogData mergedData) {\n\t\t// move all obs that weren't contained in encounters\n\t\t// TODO: this should be a copy, not a move\n\t\tObsService obsService = Context.getObsService();\n\t\tfor (Obs obs : obsService.getObservationsByPerson(notPreferred)) {\n\t\t\tif (obs.getEncounter() == null && !obs.getVoided()) {\n\t\t\t\tobs.setPerson(preferred);\n\t\t\t\tObs persisted = obsService.saveObs(obs, \"Merged from patient #\" + notPreferred.getPatientId());\n\t\t\t\tmergedData.addMovedIndependentObservation(persisted.getUuid());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void mergeIdentifiers(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// move all identifiers\n\t\t// (must be done after all calls to services above so hbm doesn't try to save things prematurely (hacky)\n\t\tfor (PatientIdentifier pi : notPreferred.getActiveIdentifiers()) {\n\t\t\tPatientIdentifier tmpIdentifier = new PatientIdentifier();\n\t\t\ttmpIdentifier.setIdentifier(pi.getIdentifier());\n\t\t\ttmpIdentifier.setIdentifierType(pi.getIdentifierType());\n\t\t\ttmpIdentifier.setLocation(pi.getLocation());\n\t\t\ttmpIdentifier.setPatient(preferred);\n\t\t\tboolean found = false;\n\t\t\tfor (PatientIdentifier preferredIdentifier : preferred.getIdentifiers()) {\n\t\t\t\tif (preferredIdentifier.getIdentifier() != null\n\t\t\t\t        && preferredIdentifier.getIdentifier().equals(tmpIdentifier.getIdentifier())",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 73,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 749,
    "end_line": 778,
    "snippet": "\t\t\ttmpIdentifier.setIdentifier(pi.getIdentifier());\n\t\t\ttmpIdentifier.setIdentifierType(pi.getIdentifierType());\n\t\t\ttmpIdentifier.setLocation(pi.getLocation());\n\t\t\ttmpIdentifier.setPatient(preferred);\n\t\t\tboolean found = false;\n\t\t\tfor (PatientIdentifier preferredIdentifier : preferred.getIdentifiers()) {\n\t\t\t\tif (preferredIdentifier.getIdentifier() != null\n\t\t\t\t        && preferredIdentifier.getIdentifier().equals(tmpIdentifier.getIdentifier())\n\t\t\t\t        && preferredIdentifier.getIdentifierType() != null\n\t\t\t\t        && preferredIdentifier.getIdentifierType().equals(tmpIdentifier.getIdentifierType())) {\n\t\t\t\t\tfound = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!found) {\n\t\t\t\ttmpIdentifier.setIdentifierType(pi.getIdentifierType());\n\t\t\t\ttmpIdentifier.setCreator(Context.getAuthenticatedUser());\n\t\t\t\ttmpIdentifier.setDateCreated(new Date());\n\t\t\t\ttmpIdentifier.setVoided(false);\n\t\t\t\ttmpIdentifier.setVoidedBy(null);\n\t\t\t\ttmpIdentifier.setVoidReason(null);\n\t\t\t\ttmpIdentifier.setUuid(UUID.randomUUID().toString());\n\t\t\t\t// we don't want to change the preferred identifier of the preferred patient\n\t\t\t\ttmpIdentifier.setPreferred(false);\n\t\t\t\tpreferred.addIdentifier(tmpIdentifier);\n\t\t\t\tmergedData.addCreatedIdentifier(tmpIdentifier.getUuid());\n\t\t\t\tlog.debug(\"Merging identifier \" + tmpIdentifier.getIdentifier() + \" to \" + preferred.getPatientId());\n\t\t\t}\n\t\t}\n\t}\n\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 74,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 771,
    "end_line": 800,
    "snippet": "\t\t\t\ttmpIdentifier.setPreferred(false);\n\t\t\t\tpreferred.addIdentifier(tmpIdentifier);\n\t\t\t\tmergedData.addCreatedIdentifier(tmpIdentifier.getUuid());\n\t\t\t\tlog.debug(\"Merging identifier \" + tmpIdentifier.getIdentifier() + \" to \" + preferred.getPatientId());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void mergeDateOfDeath(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\tmergedData.setPriorDateOfDeath(preferred.getDeathDate());\n\t\tif (preferred.getDeathDate() == null) {\n\t\t\tpreferred.setDeathDate(notPreferred.getDeathDate());\n\t\t}\n\t\t\n\t\tif (preferred.getCauseOfDeath() != null) {\n\t\t\tmergedData.setPriorCauseOfDeath(preferred.getCauseOfDeath().getUuid());\n\t\t}\n\t\tif (preferred.getCauseOfDeath() == null) {\n\t\t\tpreferred.setCauseOfDeath(notPreferred.getCauseOfDeath());\n\t\t}\n\t}\n\t\n\tprivate void mergeDateOfBirth(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\tmergedData.setPriorDateOfBirth(preferred.getBirthdate());\n\t\tmergedData.setPriorDateOfBirthEstimated(preferred.getBirthdateEstimated());\n\t\tif (preferred.getBirthdate() == null || (preferred.getBirthdateEstimated() && !notPreferred.getBirthdateEstimated())) {\n\t\t\tpreferred.setBirthdate(notPreferred.getBirthdate());\n\t\t\tpreferred.setBirthdateEstimated(notPreferred.getBirthdateEstimated());\n\t\t}\n\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 75,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 793,
    "end_line": 822,
    "snippet": "\tprivate void mergeDateOfBirth(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\tmergedData.setPriorDateOfBirth(preferred.getBirthdate());\n\t\tmergedData.setPriorDateOfBirthEstimated(preferred.getBirthdateEstimated());\n\t\tif (preferred.getBirthdate() == null || (preferred.getBirthdateEstimated() && !notPreferred.getBirthdateEstimated())) {\n\t\t\tpreferred.setBirthdate(notPreferred.getBirthdate());\n\t\t\tpreferred.setBirthdateEstimated(notPreferred.getBirthdateEstimated());\n\t\t}\n\t}\n\t\n\tprivate void mergePersonAttributes(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// copy person attributes\n\t\tfor (PersonAttribute attr : notPreferred.getAttributes()) {\n\t\t\tif (!attr.getVoided()) {\n\t\t\t\tPersonAttribute tmpAttr = attr.copy();\n\t\t\t\ttmpAttr.setPerson(null);\n\t\t\t\ttmpAttr.setUuid(UUID.randomUUID().toString());\n\t\t\t\tpreferred.addAttribute(tmpAttr);\n\t\t\t\tmergedData.addCreatedAttribute(tmpAttr.getUuid());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate void mergeGenderInformation(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// move all other patient info\n\t\tmergedData.setPriorGender(preferred.getGender());\n\t\tif (!\"M\".equals(preferred.getGender()) && !\"F\".equals(preferred.getGender())) {\n\t\t\tpreferred.setGender(notPreferred.getGender());\n\t\t}\n\t}\n\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 76,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 815,
    "end_line": 844,
    "snippet": "\tprivate void mergeGenderInformation(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// move all other patient info\n\t\tmergedData.setPriorGender(preferred.getGender());\n\t\tif (!\"M\".equals(preferred.getGender()) && !\"F\".equals(preferred.getGender())) {\n\t\t\tpreferred.setGender(notPreferred.getGender());\n\t\t}\n\t}\n\t\n\tprivate void mergeNames(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData) {\n\t\t// move all names\n\t\t// (must be done after all calls to services above so hbm doesn't try to save things prematurely (hacky)\n\t\tfor (PersonName newName : notPreferred.getNames()) {\n\t\t\tboolean containsName = false;\n\t\t\tfor (PersonName currentName : preferred.getNames()) {\n\t\t\t\tcontainsName = currentName.equalsContent(newName);\n\t\t\t\tif (containsName) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!containsName) {\n\t\t\t\tPersonName tmpName = constructTemporaryName(newName);\n\t\t\t\tpreferred.addName(tmpName);\n\t\t\t\tmergedData.addCreatedName(tmpName.getUuid());\n\t\t\t\tlog.debug(\"Merging name \" + newName.getGivenName() + \" to \" + preferred.getPatientId());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate PersonName constructTemporaryName(PersonName newName) {\n\t\tPersonName tmpName = PersonName.newInstance(newName);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 77,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 837,
    "end_line": 866,
    "snippet": "\t\t\t\tmergedData.addCreatedName(tmpName.getUuid());\n\t\t\t\tlog.debug(\"Merging name \" + newName.getGivenName() + \" to \" + preferred.getPatientId());\n\t\t\t}\n\t\t}\n\t}\n\t\n\tprivate PersonName constructTemporaryName(PersonName newName) {\n\t\tPersonName tmpName = PersonName.newInstance(newName);\n\t\ttmpName.setPersonNameId(null);\n\t\ttmpName.setVoided(false);\n\t\ttmpName.setVoidedBy(null);\n\t\ttmpName.setVoidReason(null);\n\t\t// we don't want to change the preferred name of the preferred patient\n\t\ttmpName.setPreferred(false);\n\t\ttmpName.setUuid(UUID.randomUUID().toString());\n\t\treturn tmpName;\n\t}\n\t\n\tprivate void mergeAddresses(Patient preferred, Patient notPreferred, PersonMergeLogData mergedData)\n\t        throws SerializationException {\n\t\t// move all addresses\n\t\t// (must be done after all calls to services above so hbm doesn't try to save things prematurely (hacky)\n\t\tfor (PersonAddress newAddress : notPreferred.getAddresses()) {\n\t\t\tboolean containsAddress = false;\n\t\t\tfor (PersonAddress currentAddress : preferred.getAddresses()) {\n\t\t\t\tcontainsAddress = currentAddress.equalsContent(newAddress);\n\t\t\t\tif (containsAddress) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 78,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 859,
    "end_line": 888,
    "snippet": "\t\tfor (PersonAddress newAddress : notPreferred.getAddresses()) {\n\t\t\tboolean containsAddress = false;\n\t\t\tfor (PersonAddress currentAddress : preferred.getAddresses()) {\n\t\t\t\tcontainsAddress = currentAddress.equalsContent(newAddress);\n\t\t\t\tif (containsAddress) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!containsAddress) {\n\t\t\t\tPersonAddress tmpAddress = (PersonAddress) newAddress.clone();\n\t\t\t\ttmpAddress.setPersonAddressId(null);\n\t\t\t\ttmpAddress.setVoided(false);\n\t\t\t\ttmpAddress.setVoidedBy(null);\n\t\t\t\ttmpAddress.setVoidReason(null);\n\t\t\t\ttmpAddress.setPreferred(false); // addresses from non-preferred patient shouldn't be marked as preferred\n\t\t\t\ttmpAddress.setUuid(UUID.randomUUID().toString());\n\t\t\t\tpreferred.addAddress(tmpAddress);\n\t\t\t\tmergedData.addCreatedAddress(tmpAddress.getUuid());\n\t\t\t\tlog.debug(\"Merging address \" + newAddress.getPersonAddressId() + \" to \" + preferred.getPatientId());\n\t\t\t}\n\t\t}\n\t\t\n\t\t// copy person attributes\n\t\tfor (PersonAttribute attr : notPreferred.getAttributes()) {\n\t\t\tif (!attr.getVoided()) {\n\t\t\t\tPersonAttribute tmpAttr = attr.copy();\n\t\t\t\ttmpAttr.setPerson(null);\n\t\t\t\ttmpAttr.setUuid(UUID.randomUUID().toString());\n\t\t\t\tpreferred.addAttribute(tmpAttr);\n\t\t\t\tmergedData.addCreatedAttribute(tmpAttr.getUuid());",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 79,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 881,
    "end_line": 910,
    "snippet": "\t\t// copy person attributes\n\t\tfor (PersonAttribute attr : notPreferred.getAttributes()) {\n\t\t\tif (!attr.getVoided()) {\n\t\t\t\tPersonAttribute tmpAttr = attr.copy();\n\t\t\t\ttmpAttr.setPerson(null);\n\t\t\t\ttmpAttr.setUuid(UUID.randomUUID().toString());\n\t\t\t\tpreferred.addAttribute(tmpAttr);\n\t\t\t\tmergedData.addCreatedAttribute(tmpAttr.getUuid());\n\t\t\t}\n\t\t}\n\t\t\n\t\t// move all other patient info\n\t\tmergedData.setPriorGender(preferred.getGender());\n\t\tif (!\"M\".equals(preferred.getGender()) && !\"F\".equals(preferred.getGender())) {\n\t\t\tpreferred.setGender(notPreferred.getGender());\n\t\t}\n\n\t\tmergedData.setPriorDateOfBirth(preferred.getBirthdate());\n\t\tmergedData.setPriorDateOfBirthEstimated(preferred.getBirthdateEstimated());\n\t\tif (preferred.getBirthdate() == null || (preferred.getBirthdateEstimated() && !notPreferred.getBirthdateEstimated())) {\n\t\t\tpreferred.setBirthdate(notPreferred.getBirthdate());\n\t\t\tpreferred.setBirthdateEstimated(notPreferred.getBirthdateEstimated());\n\t\t}\n\t\tmergedData.setPriorDateOfDeathEstimated(preferred.getDeathdateEstimated());\n\t\tif (preferred.getDeathdateEstimated() == null) {\n\t\t\tpreferred.setDeathdateEstimated(notPreferred.getDeathdateEstimated());\n\t\t}\n\t\t\n\t\tmergedData.setPriorDateOfDeath(preferred.getDeathDate());\n\t\tif (preferred.getDeathDate() == null) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 80,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 903,
    "end_line": 932,
    "snippet": "\t\t}\n\t\tmergedData.setPriorDateOfDeathEstimated(preferred.getDeathdateEstimated());\n\t\tif (preferred.getDeathdateEstimated() == null) {\n\t\t\tpreferred.setDeathdateEstimated(notPreferred.getDeathdateEstimated());\n\t\t}\n\t\t\n\t\tmergedData.setPriorDateOfDeath(preferred.getDeathDate());\n\t\tif (preferred.getDeathDate() == null) {\n\t\t\tpreferred.setDeathDate(notPreferred.getDeathDate());\n\t\t}\n\t\t\n\t\tif (preferred.getCauseOfDeath() != null) {\n\t\t\tmergedData.setPriorCauseOfDeath(preferred.getCauseOfDeath().getUuid());\n\t\t}\n\t\tif (preferred.getCauseOfDeath() == null) {\n\t\t\tpreferred.setCauseOfDeath(notPreferred.getCauseOfDeath());\n\t\t}\n\t\t\n\t\t// void the non preferred patient\n\t\tContext.getPatientService().voidPatient(notPreferred, \"Merged with patient #\" + preferred.getPatientId());\n\t\t\n\t\t// void the person associated with not preferred patient\n\t\tContext.getPersonService().voidPerson(notPreferred,\n\t\t    \"The patient corresponding to this person has been voided and Merged with patient #\" + preferred.getPatientId());\n\t\t\n\t\t// associate the Users associated with the not preferred person, to the preferred person.\n\t\tchangeUserAssociations(preferred, notPreferred, mergedData);\n\t\t\n\t\t// Save the newly update preferred patient\n\t\t// This must be called _after_ voiding the nonPreferred patient so that",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 81,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 925,
    "end_line": 954,
    "snippet": "\t\tContext.getPersonService().voidPerson(notPreferred,\n\t\t    \"The patient corresponding to this person has been voided and Merged with patient #\" + preferred.getPatientId());\n\t\t\n\t\t// associate the Users associated with the not preferred person, to the preferred person.\n\t\tchangeUserAssociations(preferred, notPreferred, mergedData);\n\t\t\n\t\t// Save the newly update preferred patient\n\t\t// This must be called _after_ voiding the nonPreferred patient so that\n\t\t//  a \"Duplicate Identifier\" error doesn't pop up.\n\t\tsavePatient(preferred);\n\t\t\n\t\t//save the person merge log\n\t\tPersonMergeLog personMergeLog = new PersonMergeLog();\n\t\tpersonMergeLog.setWinner(preferred);\n\t\tpersonMergeLog.setLoser(notPreferred);\n\t\tpersonMergeLog.setPersonMergeLogData(mergedData);\n\t\tContext.getPersonService().savePersonMergeLog(personMergeLog);\n\t}\n\t\n\t/**\n\t * Change user associations for notPreferred to preferred person.\n\t * \n\t * @param preferred\n\t * @param notPreferred\n\t * @param mergedData a patient merge audit data object to update\n\t * @see PatientServiceImpl#mergePatients(Patient, Patient)\n\t */\n\tprivate void changeUserAssociations(Patient preferred, Person notPreferred, PersonMergeLogData mergedData) {\n\t\tUserService userService = Context.getUserService();\n\t\tList<User> users = userService.getUsersByPerson(notPreferred, true);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 82,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 947,
    "end_line": 976,
    "snippet": "\t * @param preferred\n\t * @param notPreferred\n\t * @param mergedData a patient merge audit data object to update\n\t * @see PatientServiceImpl#mergePatients(Patient, Patient)\n\t */\n\tprivate void changeUserAssociations(Patient preferred, Person notPreferred, PersonMergeLogData mergedData) {\n\t\tUserService userService = Context.getUserService();\n\t\tList<User> users = userService.getUsersByPerson(notPreferred, true);\n\t\tfor (User user : users) {\n\t\t\tuser.setPerson(preferred);\n\t\t\tUser persisted = userService.saveUser(user);\n\t\t\tif (mergedData != null) {\n\t\t\t\tmergedData.addMovedUser(persisted.getUuid());\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * This is the way to establish that a patient has left the care center. This API call is\n\t * responsible for:\n\t * <ol>\n\t * <li>Closing workflow statuses</li>\n\t * <li>Terminating programs</li>\n\t * <li>Discontinuing orders</li>\n\t * <li>Flagging patient table</li>\n\t * <li>Creating any relevant observations about the patient (if applicable)</li>\n\t * </ol>\n\t * \n\t * @param patient - the patient who has exited care\n\t * @param dateExited - the declared date/time of the patient's exit",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 83,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 969,
    "end_line": 998,
    "snippet": "\t * <li>Terminating programs</li>\n\t * <li>Discontinuing orders</li>\n\t * <li>Flagging patient table</li>\n\t * <li>Creating any relevant observations about the patient (if applicable)</li>\n\t * </ol>\n\t * \n\t * @param patient - the patient who has exited care\n\t * @param dateExited - the declared date/time of the patient's exit\n\t * @param reasonForExit - the concept that corresponds with why the patient has been declared as\n\t *            exited\n\t * @throws APIException\n\t */\n\tpublic void exitFromCare(Patient patient, Date dateExited, Concept reasonForExit) throws APIException {\n\t\t\n\t\tif (patient == null) {\n\t\t\tthrow new APIException(\"Patient.invalid.care\", (Object[]) null);\n\t\t}\n\t\tif (dateExited == null) {\n\t\t\tthrow new APIException(\"Patient.no.valid.dateExited\", (Object[]) null);\n\t\t}\n\t\tif (reasonForExit == null) {\n\t\t\tthrow new APIException(\"Patient.no.valid.reasonForExit\", (Object[]) null);\n\t\t}\n\t\t\n\t\t// need to create an observation to represent this (otherwise how\n\t\t// will we know?)\n\t\tsaveReasonForExitObs(patient, dateExited, reasonForExit);\n\t}\n\t\n\t/**",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 84,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 991,
    "end_line": 1020,
    "snippet": "\t\t}\n\t\t\n\t\t// need to create an observation to represent this (otherwise how\n\t\t// will we know?)\n\t\tsaveReasonForExitObs(patient, dateExited, reasonForExit);\n\t}\n\t\n\t/**\n\t * TODO: Patients should actually be allowed to exit multiple times\n\t * \n\t * @param patient\n\t * @param exitDate\n\t * @param cause\n\t */\n\tprivate void saveReasonForExitObs(Patient patient, Date exitDate, Concept cause) throws APIException {\n\t\t\n\t\tif (patient == null) {\n\t\t\tthrow new APIException(\"Patient.null\", (Object[]) null);\n\t\t}\n\t\tif (exitDate == null) {\n\t\t\tthrow new APIException(\"Patient.exit.date.null\", (Object[]) null);\n\t\t}\n\t\tif (cause == null) {\n\t\t\tthrow new APIException(\"Patient.cause.null\", (Object[]) null);\n\t\t}\n\t\t\n\t\t// need to make sure there is an Obs that represents the patient's\n\t\t// exit\n\t\tlog.debug(\"Patient is exiting, so let's make sure there's an Obs for it\");\n\t\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 85,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1013,
    "end_line": 1042,
    "snippet": "\t\tif (cause == null) {\n\t\t\tthrow new APIException(\"Patient.cause.null\", (Object[]) null);\n\t\t}\n\t\t\n\t\t// need to make sure there is an Obs that represents the patient's\n\t\t// exit\n\t\tlog.debug(\"Patient is exiting, so let's make sure there's an Obs for it\");\n\t\t\n\t\tString codProp = Context.getAdministrationService().getGlobalProperty(\"concept.reasonExitedCare\");\n\t\tConcept reasonForExit = Context.getConceptService().getConcept(codProp);\n\t\t\n\t\tif (reasonForExit != null) {\n\t\t\tList<Obs> obssExit = Context.getObsService().getObservationsByPersonAndConcept(patient, reasonForExit);\n\t\t\tif (obssExit != null) {\n\t\t\t\tif (obssExit.size() > 1) {\n\t\t\t\t\tlog.error(\"Multiple reasons for exit (\" + obssExit.size() + \")?  Shouldn't be...\");\n\t\t\t\t} else {\n\t\t\t\t\tObs obsExit;\n\t\t\t\t\tif (obssExit.size() == 1) {\n\t\t\t\t\t\t// already has a reason for exit - let's edit it.\n\t\t\t\t\t\tlog.debug(\"Already has a reason for exit, so changing it\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tobsExit = obssExit.iterator().next();\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// no reason for exit obs yet, so let's make one\n\t\t\t\t\t\tlog.debug(\"No reason for exit yet, let's create one.\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tobsExit = new Obs();\n\t\t\t\t\t\tobsExit.setPerson(patient);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 86,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1035,
    "end_line": 1064,
    "snippet": "\t\t\t\t\t\tobsExit = obssExit.iterator().next();\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// no reason for exit obs yet, so let's make one\n\t\t\t\t\t\tlog.debug(\"No reason for exit yet, let's create one.\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tobsExit = new Obs();\n\t\t\t\t\t\tobsExit.setPerson(patient);\n\t\t\t\t\t\tobsExit.setConcept(reasonForExit);\n\t\t\t\t\t\t\n\t\t\t\t\t\tLocation loc = Context.getLocationService().getDefaultLocation();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (loc != null) {\n\t\t\t\t\t\t\tobsExit.setLocation(loc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlog.error(\"Could not find a suitable location for which to create this new Obs\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (obsExit != null) {\n\t\t\t\t\t\t// put the right concept and (maybe) text in this\n\t\t\t\t\t\t// obs\n\t\t\t\t\t\tobsExit.setValueCoded(cause);\n\t\t\t\t\t\tobsExit.setValueCodedName(cause.getName()); // ABKTODO: presume current locale?\n\t\t\t\t\t\tobsExit.setObsDatetime(exitDate);\n\t\t\t\t\t\tContext.getObsService().saveObs(obsExit, \"updated by PatientService.saveReasonForExit\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 87,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1057,
    "end_line": 1086,
    "snippet": "\t\t\t\t\t\tobsExit.setValueCoded(cause);\n\t\t\t\t\t\tobsExit.setValueCodedName(cause.getName()); // ABKTODO: presume current locale?\n\t\t\t\t\t\tobsExit.setObsDatetime(exitDate);\n\t\t\t\t\t\tContext.getObsService().saveObs(obsExit, \"updated by PatientService.saveReasonForExit\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tlog.debug(\"Reason for exit is null - should not have gotten here without throwing an error on the form.\");\n\t\t}\n\t\t\n\t}\n\t\n\t/**\n\t * This is the way to establish that a patient has died. In addition to exiting the patient from\n\t * care (see above), this method will also set the appropriate patient characteristics to\n\t * indicate that they have died, when they died, etc.\n\t * \n\t * @param patient - the patient who has died\n\t * @param dateDied - the declared date/time of the patient's death\n\t * @param causeOfDeath - the concept that corresponds with the reason the patient died\n\t * @param otherReason - in case the causeOfDeath is 'other', a place to store more info\n\t * @throws APIException\n\t */\n\t@Override\n\tpublic void processDeath(Patient patient, Date dateDied, Concept causeOfDeath, String otherReason) throws APIException {\n\t\t\n\t\tif (patient != null && dateDied != null && causeOfDeath != null) {\n\t\t\t// set appropriate patient characteristics\n\t\t\tpatient.setDead(true);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 88,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1079,
    "end_line": 1108,
    "snippet": "\t * @throws APIException\n\t */\n\t@Override\n\tpublic void processDeath(Patient patient, Date dateDied, Concept causeOfDeath, String otherReason) throws APIException {\n\t\t\n\t\tif (patient != null && dateDied != null && causeOfDeath != null) {\n\t\t\t// set appropriate patient characteristics\n\t\t\tpatient.setDead(true);\n\t\t\tpatient.setDeathDate(dateDied);\n\t\t\tpatient.setCauseOfDeath(causeOfDeath);\n\t\t\tthis.savePatient(patient);\n\t\t\tsaveCauseOfDeathObs(patient, dateDied, causeOfDeath, otherReason);\n\t\t\t\n\t\t\t// exit from program\n\t\t\t// first, need to get Concept for \"Patient Died\"\n\t\t\tString strPatientDied = Context.getAdministrationService().getGlobalProperty(\"concept.patientDied\");\n\t\t\tConcept conceptPatientDied = Context.getConceptService().getConcept(strPatientDied);\n\t\t\t\n\t\t\tif (conceptPatientDied == null) {\n\t\t\t\tlog.debug(\"ConceptPatientDied is null\");\n\t\t\t}\n\t\t\texitFromCare(patient, dateDied, conceptPatientDied);\n\t\t\t\n\t\t} else {\n\t\t\tif (patient == null) {\n\t\t\t\tthrow new APIException(\"Patient.invalid.dead\", (Object[]) null);\n\t\t\t}\n\t\t\tif (dateDied == null) {\n\t\t\t\tthrow new APIException(\"Patient.no.valid.dateDied\", (Object[]) null);\n\t\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 89,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1101,
    "end_line": 1130,
    "snippet": "\t\t\t\n\t\t} else {\n\t\t\tif (patient == null) {\n\t\t\t\tthrow new APIException(\"Patient.invalid.dead\", (Object[]) null);\n\t\t\t}\n\t\t\tif (dateDied == null) {\n\t\t\t\tthrow new APIException(\"Patient.no.valid.dateDied\", (Object[]) null);\n\t\t\t}\n\t\t\tif (causeOfDeath == null) {\n\t\t\t\tthrow new APIException(\"Patient.no.valid.causeOfDeath\", (Object[]) null);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#saveCauseOfDeathObs(org.openmrs.Patient, java.util.Date,\n\t *      org.openmrs.Concept, java.lang.String)\n\t */\n\t@Override\n\tpublic void saveCauseOfDeathObs(Patient patient, Date deathDate, Concept cause, String otherReason) throws APIException {\n\t\t\n\t\tif (patient == null) {\n\t\t\tthrow new APIException(\"Patient.null\", (Object[]) null);\n\t\t}\n\t\tif (deathDate == null) {\n\t\t\tthrow new APIException(\"Patient.death.date.null\", (Object[]) null);\n\t\t}\n\t\tif (cause == null) {\n\t\t\tthrow new APIException(\"Patient.cause.null\", (Object[]) null);\n\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 90,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1123,
    "end_line": 1152,
    "snippet": "\t\t\tthrow new APIException(\"Patient.null\", (Object[]) null);\n\t\t}\n\t\tif (deathDate == null) {\n\t\t\tthrow new APIException(\"Patient.death.date.null\", (Object[]) null);\n\t\t}\n\t\tif (cause == null) {\n\t\t\tthrow new APIException(\"Patient.cause.null\", (Object[]) null);\n\t\t}\n\t\t\n\t\tif (!patient.getDead()) {\n\t\t\tpatient.setDead(true);\n\t\t\tpatient.setDeathDate(deathDate);\n\t\t\tpatient.setCauseOfDeath(cause);\n\t\t}\n\t\t\n\t\tlog.debug(\"Patient is dead, so let's make sure there's an Obs for it\");\n\t\t// need to make sure there is an Obs that represents the patient's\n\t\t// cause of death, if applicable\n\t\t\n\t\tString codProp = Context.getAdministrationService().getGlobalProperty(\"concept.causeOfDeath\");\n\t\t\n\t\tConcept causeOfDeath = Context.getConceptService().getConcept(codProp);\n\t\t\n\t\tif (causeOfDeath != null) {\n\t\t\tList<Obs> obssDeath = Context.getObsService().getObservationsByPersonAndConcept(patient, causeOfDeath);\n\t\t\tif (obssDeath != null) {\n\t\t\t\tif (obssDeath.size() > 1) {\n\t\t\t\t\tlog.error(\"Multiple causes of death (\" + obssDeath.size() + \")?  Shouldn't be...\");\n\t\t\t\t} else {\n\t\t\t\t\tObs obsDeath;",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 91,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1145,
    "end_line": 1174,
    "snippet": "\t\t\n\t\tif (causeOfDeath != null) {\n\t\t\tList<Obs> obssDeath = Context.getObsService().getObservationsByPersonAndConcept(patient, causeOfDeath);\n\t\t\tif (obssDeath != null) {\n\t\t\t\tif (obssDeath.size() > 1) {\n\t\t\t\t\tlog.error(\"Multiple causes of death (\" + obssDeath.size() + \")?  Shouldn't be...\");\n\t\t\t\t} else {\n\t\t\t\t\tObs obsDeath;\n\t\t\t\t\tif (obssDeath.size() == 1) {\n\t\t\t\t\t\t// already has a cause of death - let's edit it.\n\t\t\t\t\t\tlog.debug(\"Already has a cause of death, so changing it\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tobsDeath = obssDeath.iterator().next();\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// no cause of death obs yet, so let's make one\n\t\t\t\t\t\tlog.debug(\"No cause of death yet, let's create one.\");\n\t\t\t\t\t\t\n\t\t\t\t\t\tobsDeath = new Obs();\n\t\t\t\t\t\tobsDeath.setPerson(patient);\n\t\t\t\t\t\tobsDeath.setConcept(causeOfDeath);\n\t\t\t\t\t\tLocation location = Context.getLocationService().getDefaultLocation();\n\t\t\t\t\t\tif (location != null) {\n\t\t\t\t\t\t\tobsDeath.setLocation(location);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlog.error(\"Could not find a suitable location for which to create this new Obs\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// put the right concept and (maybe) text in this obs",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 92,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1167,
    "end_line": 1196,
    "snippet": "\t\t\t\t\t\tif (location != null) {\n\t\t\t\t\t\t\tobsDeath.setLocation(location);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlog.error(\"Could not find a suitable location for which to create this new Obs\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// put the right concept and (maybe) text in this obs\n\t\t\t\t\tConcept currCause = patient.getCauseOfDeath();\n\t\t\t\t\tif (currCause == null) {\n\t\t\t\t\t\t// set to NONE\n\t\t\t\t\t\tlog.debug(\"Current cause is null, attempting to set to NONE\");\n\t\t\t\t\t\tString noneConcept = Context.getAdministrationService().getGlobalProperty(\"concept.none\");\n\t\t\t\t\t\tcurrCause = Context.getConceptService().getConcept(noneConcept);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (currCause != null) {\n\t\t\t\t\t\tlog.debug(\"Current cause is not null, setting to value_coded\");\n\t\t\t\t\t\tobsDeath.setValueCoded(currCause);\n\t\t\t\t\t\tobsDeath.setValueCodedName(currCause.getName()); // ABKTODO: presume current locale?\n\t\t\t\t\t\t\n\t\t\t\t\t\tDate dateDeath = patient.getDeathDate();\n\t\t\t\t\t\tif (dateDeath == null) {\n\t\t\t\t\t\t\tdateDeath = new Date();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobsDeath.setObsDatetime(dateDeath);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// check if this is an \"other\" concept - if so, then\n\t\t\t\t\t\t// we need to add value_text\n\t\t\t\t\t\tString otherConcept = Context.getAdministrationService().getGlobalProperty(\"concept.otherNonCoded\");",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 93,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1189,
    "end_line": 1218,
    "snippet": "\t\t\t\t\t\tif (dateDeath == null) {\n\t\t\t\t\t\t\tdateDeath = new Date();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tobsDeath.setObsDatetime(dateDeath);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// check if this is an \"other\" concept - if so, then\n\t\t\t\t\t\t// we need to add value_text\n\t\t\t\t\t\tString otherConcept = Context.getAdministrationService().getGlobalProperty(\"concept.otherNonCoded\");\n\t\t\t\t\t\tConcept conceptOther = Context.getConceptService().getConcept(otherConcept);\n\t\t\t\t\t\tif (conceptOther != null) {\n\t\t\t\t\t\t\tif (conceptOther.equals(currCause)) {\n\t\t\t\t\t\t\t\t// seems like this is an other concept -\n\t\t\t\t\t\t\t\t// let's try to get the \"other\" field info\n\t\t\t\t\t\t\t\tlog.debug(\"Setting value_text as \" + otherReason);\n\t\t\t\t\t\t\t\tobsDeath.setValueText(otherReason);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlog.debug(\"New concept is NOT the OTHER concept, so setting to blank\");\n\t\t\t\t\t\t\t\tobsDeath.setValueText(\"\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlog.debug(\"Don't seem to know about an OTHER concept, so deleting value_text\");\n\t\t\t\t\t\t\tobsDeath.setValueText(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tContext.getObsService().saveObs(obsDeath, \"updated by PatientService.saveCauseOfDeathObs\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.debug(\"Current cause is still null - aborting mission\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 94,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1211,
    "end_line": 1240,
    "snippet": "\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tContext.getObsService().saveObs(obsDeath, \"updated by PatientService.saveCauseOfDeathObs\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog.debug(\"Current cause is still null - aborting mission\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tlog.debug(\"Cause of death is null - should not have gotten here without throwing an error on the form.\");\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientByUuid(java.lang.String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Patient getPatientByUuid(String uuid) throws APIException {\n\t\treturn dao.getPatientByUuid(uuid);\n\t}\n\t\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifier getPatientIdentifierByUuid(String uuid) throws APIException {\n\t\treturn dao.getPatientIdentifierByUuid(uuid);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierTypeByUuid(java.lang.String)",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 95,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1233,
    "end_line": 1262,
    "snippet": "\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifier getPatientIdentifierByUuid(String uuid) throws APIException {\n\t\treturn dao.getPatientIdentifierByUuid(uuid);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifierTypeByUuid(java.lang.String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifierType getPatientIdentifierTypeByUuid(String uuid) throws APIException {\n\t\treturn dao.getPatientIdentifierTypeByUuid(uuid);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getDefaultIdentifierValidator()\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic IdentifierValidator getDefaultIdentifierValidator() {\n\t\tString defaultPIV = Context.getAdministrationService().getGlobalProperty(\n\t\t    OpenmrsConstants.GLOBAL_PROPERTY_DEFAULT_PATIENT_IDENTIFIER_VALIDATOR, \"\");\n\t\t\n\t\ttry {\n\t\t\treturn identifierValidators.get(Class.forName(defaultPIV));\n\t\t}\n\t\tcatch (ClassNotFoundException e) {\n\t\t\tlog.error(\"Global Property \" + OpenmrsConstants.GLOBAL_PROPERTY_DEFAULT_PATIENT_IDENTIFIER_VALIDATOR\n\t\t\t        + \" not set to an actual class.\", e);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 96,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1255,
    "end_line": 1284,
    "snippet": "\t\t    OpenmrsConstants.GLOBAL_PROPERTY_DEFAULT_PATIENT_IDENTIFIER_VALIDATOR, \"\");\n\t\t\n\t\ttry {\n\t\t\treturn identifierValidators.get(Class.forName(defaultPIV));\n\t\t}\n\t\tcatch (ClassNotFoundException e) {\n\t\t\tlog.error(\"Global Property \" + OpenmrsConstants.GLOBAL_PROPERTY_DEFAULT_PATIENT_IDENTIFIER_VALIDATOR\n\t\t\t        + \" not set to an actual class.\", e);\n\t\t\treturn identifierValidators.get(LuhnIdentifierValidator.class);\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getIdentifierValidator(java.lang.String)\n\t */\n\t@Override\n\tpublic IdentifierValidator getIdentifierValidator(Class<IdentifierValidator> identifierValidator) {\n\t\treturn identifierValidators.get(identifierValidator);\n\t}\n\t\n\tpublic Map<Class<? extends IdentifierValidator>, IdentifierValidator> getIdentifierValidators() {\n\t\tif (identifierValidators == null) {\n\t\t\tidentifierValidators = new LinkedHashMap<>();\n\t\t}\n\t\treturn identifierValidators;\n\t}\n\t\n\t/**\n\t * ADDs identifierValidators, doesn't replace them\n\t * ",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 97,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1277,
    "end_line": 1306,
    "snippet": "\t\t\tidentifierValidators = new LinkedHashMap<>();\n\t\t}\n\t\treturn identifierValidators;\n\t}\n\t\n\t/**\n\t * ADDs identifierValidators, doesn't replace them\n\t * \n\t * @param identifierValidators\n\t */\n\tpublic void setIdentifierValidators(Map<Class<? extends IdentifierValidator>, IdentifierValidator> identifierValidators) {\n\t\tif (identifierValidators == null) {\n\t\t\tthis.identifierValidators = null;\n\t\t\treturn;\n\t\t}\n\t\tfor (Map.Entry<Class<? extends IdentifierValidator>, IdentifierValidator> entry : identifierValidators.entrySet()) {\n\t\t\tgetIdentifierValidators().put(entry.getKey(), entry.getValue());\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllIdentifierValidators()\n\t */\n\t@Override\n\tpublic Collection<IdentifierValidator> getAllIdentifierValidators() {\n\t\treturn identifierValidators.values();\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getIdentifierValidator(java.lang.String)",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 98,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1299,
    "end_line": 1328,
    "snippet": "\t */\n\t@Override\n\tpublic Collection<IdentifierValidator> getAllIdentifierValidators() {\n\t\treturn identifierValidators.values();\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getIdentifierValidator(java.lang.String)\n\t */\n\t@Override\n\t@SuppressWarnings(\"unchecked\")\n\t@Transactional(readOnly = true)\n\tpublic IdentifierValidator getIdentifierValidator(String pivClassName) {\n\t\tif (StringUtils.isBlank(pivClassName)) {\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\treturn getIdentifierValidator((Class<IdentifierValidator>) Context.loadClass(pivClassName));\n\t\t}\n\t\tcatch (ClassNotFoundException e) {\n\t\t\tthrow new PatientIdentifierException(\"Could not find patient identifier validator \" + pivClassName, e);\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#isIdentifierInUseByAnotherPatient(org.openmrs.PatientIdentifier)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 99,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1321,
    "end_line": 1350,
    "snippet": "\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#isIdentifierInUseByAnotherPatient(org.openmrs.PatientIdentifier)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic boolean isIdentifierInUseByAnotherPatient(PatientIdentifier patientIdentifier) {\n\t\treturn dao.isIdentifierInUseByAnotherPatient(patientIdentifier);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getPatientIdentifier(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic PatientIdentifier getPatientIdentifier(Integer patientIdentifierId) throws APIException {\n\t\treturn dao.getPatientIdentifier(patientIdentifierId);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#voidPatientIdentifier(org.openmrs.PatientIdentifier,\n\t *      java.lang.String)\n\t */\n\t@Override\n\tpublic PatientIdentifier voidPatientIdentifier(PatientIdentifier patientIdentifier, String reason) throws APIException {\n\t\t\n\t\tif (patientIdentifier == null || StringUtils.isBlank(reason)) {\n\t\t\tthrow new APIException(\"Patient.identifier.cannot.be.null\", (Object[]) null);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 100,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1343,
    "end_line": 1372,
    "snippet": "\t * @see org.openmrs.api.PatientService#voidPatientIdentifier(org.openmrs.PatientIdentifier,\n\t *      java.lang.String)\n\t */\n\t@Override\n\tpublic PatientIdentifier voidPatientIdentifier(PatientIdentifier patientIdentifier, String reason) throws APIException {\n\t\t\n\t\tif (patientIdentifier == null || StringUtils.isBlank(reason)) {\n\t\t\tthrow new APIException(\"Patient.identifier.cannot.be.null\", (Object[]) null);\n\t\t}\n\t\treturn Context.getPatientService().savePatientIdentifier(patientIdentifier);\n\t\t\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#mergePatients(org.openmrs.Patient, java.util.List)\n\t */\n\t@Override\n\tpublic void mergePatients(Patient preferred, List<Patient> notPreferred) throws APIException, SerializationException {\n\t\t\n\t\tfor (Patient nonPreferred : notPreferred) {\n\t\t\tmergePatients(preferred, nonPreferred);\n\t\t}\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#savePatientIdentifier(org.openmrs.PatientIdentifier)\n\t */\n\t@Override\n\tpublic PatientIdentifier savePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException {\n\t\t//if the argument or the following required fields are not specified",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 101,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1365,
    "end_line": 1394,
    "snippet": "\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#savePatientIdentifier(org.openmrs.PatientIdentifier)\n\t */\n\t@Override\n\tpublic PatientIdentifier savePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException {\n\t\t//if the argument or the following required fields are not specified\n\t\tPatientIdentifierType.LocationBehavior locationBehavior = null;\n\t\tif (patientIdentifier != null) {\n\t\t\tlocationBehavior = patientIdentifier.getIdentifierType().getLocationBehavior();\n\t\t}\n\t\t\n\t\tif (patientIdentifier == null\n\t\t        || patientIdentifier.getPatient() == null\n\t\t        || patientIdentifier.getIdentifierType() == null\n\t\t        || StringUtils.isBlank(patientIdentifier.getIdentifier())\n\t\t        || (locationBehavior == PatientIdentifierType.LocationBehavior.REQUIRED && patientIdentifier.getLocation() == null)) {\n\t\t\tthrow new APIException(\"Patient.identifier.null\", (Object[]) null);\n\t\t}\n\t\tif (patientIdentifier.getPatientIdentifierId() == null) {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.ADD_PATIENT_IDENTIFIERS);\n\t\t} else {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.EDIT_PATIENT_IDENTIFIERS);\n\t\t}\n\t\t\n\t\treturn dao.savePatientIdentifier(patientIdentifier);\n\t}\n\t\n\t/**",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 102,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1387,
    "end_line": 1416,
    "snippet": "\t\t} else {\n\t\t\tContext.requirePrivilege(PrivilegeConstants.EDIT_PATIENT_IDENTIFIERS);\n\t\t}\n\t\t\n\t\treturn dao.savePatientIdentifier(patientIdentifier);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#purgePatientIdentifier(org.openmrs.PatientIdentifier)\n\t */\n\t@Override\n\tpublic void purgePatientIdentifier(PatientIdentifier patientIdentifier) throws APIException {\n\t\t\n\t\tdao.deletePatientIdentifier(patientIdentifier);\n\t\t\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllergies(org.openmrs.Patient)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Allergies getAllergies(Patient patient) {\n\t\tif (patient == null) {\n\t\t\tthrow new IllegalArgumentException(\"An existing (NOT NULL) patient is required to get allergies\");\n\t\t}\n\t\t\n\t\tAllergies allergies = new Allergies();\n\t\tList<Allergy> allergyList = dao.getAllergies(patient);\n\t\tif (!allergyList.isEmpty()) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 103,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1409,
    "end_line": 1438,
    "snippet": "\tpublic Allergies getAllergies(Patient patient) {\n\t\tif (patient == null) {\n\t\t\tthrow new IllegalArgumentException(\"An existing (NOT NULL) patient is required to get allergies\");\n\t\t}\n\t\t\n\t\tAllergies allergies = new Allergies();\n\t\tList<Allergy> allergyList = dao.getAllergies(patient);\n\t\tif (!allergyList.isEmpty()) {\n\t\t\tallergies.addAll(allergyList);\n\t\t} else {\n\t\t\tString status = dao.getAllergyStatus(patient);\n\t\t\tif (Allergies.NO_KNOWN_ALLERGIES.equals(status)) {\n\t\t\t\tallergies.confirmNoKnownAllergies();\n\t\t\t}\n\t\t}\n\t\treturn allergies;\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#setAllergies(org.openmrs.Patient,\n\t *      org.openmrs.Allergies)\n\t */\n\t@Override\n\tpublic Allergies setAllergies(Patient patient, Allergies allergies) {\n\t\t//NOTE We neither delete nor edit allergies. We instead void them.\n\t\t//Because we shield the API users from this business logic,\n\t\t//we end up with the complicated code below. :)\n\t\t\n\t\t//get the current allergies as stored in the database\n\t\tList<Allergy> dbAllergyList = getAllergies(patient);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 104,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1431,
    "end_line": 1460,
    "snippet": "\t@Override\n\tpublic Allergies setAllergies(Patient patient, Allergies allergies) {\n\t\t//NOTE We neither delete nor edit allergies. We instead void them.\n\t\t//Because we shield the API users from this business logic,\n\t\t//we end up with the complicated code below. :)\n\t\t\n\t\t//get the current allergies as stored in the database\n\t\tList<Allergy> dbAllergyList = getAllergies(patient);\n\t\tfor (Allergy originalAllergy : dbAllergyList) {\n\t\t\t//check if we still have each allergy, else it has just been deleted\n\t\t\tif (allergies.contains(originalAllergy)) {\n\t\t\t\t//we still have this allergy, check if it has been edited/changed\n\t\t\t\tAllergy potentiallyEditedAllergy = allergies.getAllergy(originalAllergy.getAllergyId());\n\t\t\t\tif (!potentiallyEditedAllergy.hasSameValues(originalAllergy)) {\n\t\t\t\t\t//allergy has been edited, so void it and create a new one with the current values\n\t\t\t\t\tAllergy newAllergy = new Allergy();\n\t\t\t\t\ttry {\n\t\t\t\t\t\t//remove the edited allergy from our current list, and void id\n\t\t\t\t\t\tallergies.remove(potentiallyEditedAllergy);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//copy values from edited allergy, and add it to the current list\n\t\t\t\t\t\tnewAllergy.copy(potentiallyEditedAllergy);\n\t\t\t\t\t\tallergies.add(newAllergy);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//we void its original values, as came from the database, \n\t\t\t\t\t\t//instead the current ones which have just been copied \n\t\t\t\t\t\t//into the new allergy we have just created above\n\t\t\t\t\t\tvoidAllergy(originalAllergy);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (Exception ex) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 105,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1453,
    "end_line": 1482,
    "snippet": "\t\t\t\t\t\tallergies.add(newAllergy);\n\t\t\t\t\t\t\n\t\t\t\t\t\t//we void its original values, as came from the database, \n\t\t\t\t\t\t//instead the current ones which have just been copied \n\t\t\t\t\t\t//into the new allergy we have just created above\n\t\t\t\t\t\tvoidAllergy(originalAllergy);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (Exception ex) {\n\t\t\t\t\t\tthrow new APIException(\"Failed to copy edited values\", ex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\t//void the allergy that has been deleted\n\t\t\tvoidAllergy(originalAllergy);\n\t\t}\n\t\t\n\t\tfor (Allergy allergy : allergies) {\n\t\t\tif (allergy.getAllergyId() == null && allergy.getAllergen().getCodedAllergen() == null\n\t\t\t        && StringUtils.isNotBlank(allergy.getAllergen().getNonCodedAllergen())) {\n\t\t\t\t\n\t\t\t\tConcept otherNonCoded = Context.getConceptService().getConceptByUuid(Allergen.getOtherNonCodedConceptUuid());\n\t\t\t\tif (otherNonCoded == null) {\n\t\t\t\t\tthrow new APIException(\"Can't find concept with uuid:\" + Allergen.getOtherNonCodedConceptUuid());\n\t\t\t\t}\n\t\t\t\tallergy.getAllergen().setCodedAllergen(otherNonCoded);\n\t\t\t}\n\t\t}\n\t\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 106,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1475,
    "end_line": 1504,
    "snippet": "\t\t\t\tConcept otherNonCoded = Context.getConceptService().getConceptByUuid(Allergen.getOtherNonCodedConceptUuid());\n\t\t\t\tif (otherNonCoded == null) {\n\t\t\t\t\tthrow new APIException(\"Can't find concept with uuid:\" + Allergen.getOtherNonCodedConceptUuid());\n\t\t\t\t}\n\t\t\t\tallergy.getAllergen().setCodedAllergen(otherNonCoded);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn dao.saveAllergies(patient, allergies);\n\t}\n\t\n\t/**\n\t * Voids a given allergy\n\t * \n\t * @param allergy the allergy to void\n\t */\n\tprivate void voidAllergy(Allergy allergy) {\n\t\tallergy.setVoided(true);\n\t\tallergy.setVoidedBy(Context.getAuthenticatedUser());\n\t\tallergy.setDateVoided(new Date());\n\t\tallergy.setVoidReason(\"Voided by API\");\n\t\tdao.saveAllergy(allergy);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllergy(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Allergy getAllergy(Integer allergyId) throws APIException {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 107,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1497,
    "end_line": 1526,
    "snippet": "\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllergy(java.lang.Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Allergy getAllergy(Integer allergyId) throws APIException {\n\t\treturn dao.getAllergy(allergyId);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#getAllergyByUuid(java.lang.String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Allergy getAllergyByUuid(String uuid) throws APIException {\n\t\treturn dao.getAllergyByUuid(uuid);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#saveAllergy(org.openmrs.Allergy)\n\t */\n\t@Override\n\tpublic void saveAllergy(Allergy allergy) throws APIException {\n\n\t\tdao.saveAllergy(allergy);\n\t}\n\t\n\t/**",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 108,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1519,
    "end_line": 1548,
    "snippet": "\t */\n\t@Override\n\tpublic void saveAllergy(Allergy allergy) throws APIException {\n\n\t\tdao.saveAllergy(allergy);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#removeAllergy(org.openmrs.Allergy,\n\t *      java.lang.String)\n\t */\n\t@Override\n\tpublic void removeAllergy(Allergy allergy, String reason) throws APIException {\n\t\tvoidAllergy(allergy, reason);\n\t}\n\t\n\t/**\n\t * @see org.openmrs.api.PatientService#voidAllergy(org.openmrs.Allergy,\n\t *      java.lang.String)\n\t */\n\t@Override\n\tpublic void voidAllergy(Allergy allergy, String reason) throws APIException {\n\n\t\tallergy.setVoided(true);\n\t\tallergy.setVoidedBy(Context.getAuthenticatedUser());\n\t\tallergy.setDateVoided(new Date());\n\t\tallergy.setVoidReason(reason);\n\t\tdao.saveAllergy(allergy);\n\t}\n\t",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 109,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1541,
    "end_line": 1570,
    "snippet": "\n\t\tallergy.setVoided(true);\n\t\tallergy.setVoidedBy(Context.getAuthenticatedUser());\n\t\tallergy.setDateVoided(new Date());\n\t\tallergy.setVoidReason(reason);\n\t\tdao.saveAllergy(allergy);\n\t}\n\t\n\t/**\n\t * @see PatientService#getCountOfPatients(String)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Integer getCountOfPatients(String query) {\n\t\tint count = 0;\n\t\tif (StringUtils.isBlank(query)) {\n\t\t\treturn count;\n\t\t}\n\t\t\n\t\treturn OpenmrsUtil.convertToInteger(dao.getCountOfPatients(query));\n\t}\n\t\n\t/**\n\t * @see PatientService#getCountOfPatients(String, boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Integer getCountOfPatients(String query, boolean includeVoided) {\n\t\tint count = 0;\n\t\tif (StringUtils.isBlank(query)) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 110,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1563,
    "end_line": 1592,
    "snippet": "\t/**\n\t * @see PatientService#getCountOfPatients(String, boolean)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic Integer getCountOfPatients(String query, boolean includeVoided) {\n\t\tint count = 0;\n\t\tif (StringUtils.isBlank(query)) {\n\t\t\treturn count;\n\t\t}\n\t\t\n\t\treturn OpenmrsUtil.convertToInteger(dao.getCountOfPatients(query, includeVoided));\n\t}\n\t\n\t/**\n\t * @see PatientService#getPatients(String, Integer, Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String query, Integer start, Integer length) throws APIException {\n\t\tList<Patient> patients = new ArrayList<>();\n\t\tif (StringUtils.isBlank(query)) {\n\t\t\treturn patients;\n\t\t}\n\t\t\n\t\treturn dao.getPatients(query, start, length);\n\t}\n\t\n\t/**\n\t * @see PatientService#getPatients(String, boolean, Integer, Integer)",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 111,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1585,
    "end_line": 1614,
    "snippet": "\t\t\treturn patients;\n\t\t}\n\t\t\n\t\treturn dao.getPatients(query, start, length);\n\t}\n\t\n\t/**\n\t * @see PatientService#getPatients(String, boolean, Integer, Integer)\n\t */\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String query, boolean includeVoided, Integer start, Integer length) throws APIException {\n\t\tif (StringUtils.isBlank(query)) {\n\t\t\treturn Collections.emptyList();\n\t\t}\n\t\t\n\t\treturn dao.getPatients(query, includeVoided, start, length);\n\t}\n\t\n\t/**\n\t * @see PatientService#getPatients(String, String, List, boolean, Integer, Integer)\n\t */\n\t// TODO - search for usage with non-empty list of patient identifier types - not used\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly, Integer start, Integer length) throws APIException {\n\t\t\n\t\tif(identifierTypes == null) {\n\t\t\treturn dao.getPatients(name != null ? name : identifier, start, length);",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 112,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1607,
    "end_line": 1636,
    "snippet": "\t// TODO - search for usage with non-empty list of patient identifier types - not used\n\t@Override\n\t@Transactional(readOnly = true)\n\tpublic List<Patient> getPatients(String name, String identifier, List<PatientIdentifierType> identifierTypes,\n\t        boolean matchIdentifierExactly, Integer start, Integer length) throws APIException {\n\t\t\n\t\tif(identifierTypes == null) {\n\t\t\treturn dao.getPatients(name != null ? name : identifier, start, length);\n\t\t}\n\t\telse {\n\t\t\treturn dao.getPatients(name != null ? name : identifier, identifierTypes, matchIdentifierExactly, start, length);\n\t\t}\n\t}\n\t\n\t/**\n\t * @see PatientService#checkIfPatientIdentifierTypesAreLocked()\n\t */\n\t@Override\n\tpublic void checkIfPatientIdentifierTypesAreLocked() {\n\t\tString locked = Context.getAdministrationService().getGlobalProperty(\n\t\t    OpenmrsConstants.GLOBAL_PROPERTY_PATIENT_IDENTIFIER_TYPES_LOCKED, \"false\");\n\t\tif (\"true\".equalsIgnoreCase(locked)) {\n\t\t\tthrow new PatientIdentifierTypeLockedException();\n\t\t}\n\t}\n\n\t/**\n\t * @see PatientService#getPatientIdentifiersByPatientProgram(org.openmrs.PatientProgram)\n\t */\n\tpublic List<PatientIdentifier> getPatientIdentifiersByPatientProgram(PatientProgram patientProgram) {",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 113,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1629,
    "end_line": 1658,
    "snippet": "\t\t\tthrow new PatientIdentifierTypeLockedException();\n\t\t}\n\t}\n\n\t/**\n\t * @see PatientService#getPatientIdentifiersByPatientProgram(org.openmrs.PatientProgram)\n\t */\n\tpublic List<PatientIdentifier> getPatientIdentifiersByPatientProgram(PatientProgram patientProgram) {\n\t\treturn dao.getPatientIdentifierByProgram(patientProgram);\n\t}\n\t\n    @Override\n    @SuppressWarnings(\"unchecked\")\n    public <T> T getRefByUuid(Class<T> type, String uuid) {\n        if (PatientIdentifier.class.equals(type)) {\n            return (T) getPatientIdentifierByUuid(uuid);\n        }\n        if (PatientIdentifierType.class.equals(type)) {\n            return (T) getPatientIdentifierTypeByUuid(uuid);\n        }\n        if (Patient.class.equals(type)) {\n            return (T) getPatientByUuid(uuid);\n        }\n        if (Allergy.class.equals(type)) {\n            return (T) getAllergyByUuid(uuid);\n        }\n        throw new APIException(\"Unsupported type for getRefByUuid: \" + type != null ? type.getName() : \"null\");\n    }\n\n    @Override",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  },
  {
    "id": 114,
    "file": "/Users/somespecies/code/openmrs-core/api/src/main/java/org/openmrs/api/impl/PatientServiceImpl.java",
    "start_line": 1651,
    "end_line": 1663,
    "snippet": "        }\n        if (Allergy.class.equals(type)) {\n            return (T) getAllergyByUuid(uuid);\n        }\n        throw new APIException(\"Unsupported type for getRefByUuid: \" + type != null ? type.getName() : \"null\");\n    }\n\n    @Override\n    public List<Class<?>> getRefTypes() {\n        return Arrays.asList(PatientIdentifier.class, PatientIdentifierType.class, Patient.class, Allergy.class);\n    }\n\n}",
    "risk_level": "HIGH",
    "risk_score": 40,
    "deps": {
      "direct": 1,
      "indirect": 1
    },
    "keywords": [
      "concept",
      "dao",
      "encounter",
      "exception",
      "identifier",
      "not null",
      "obs",
      "order",
      "patient",
      "required",
      "throw",
      "transaction",
      "validate",
      "visit"
    ],
    "signals": {
      "throws": 75,
      "validate": 1,
      "transactional": 31,
      "null_checks": 78
    }
  }
]